<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Loterias Pro - Vers√£o 3.0</title>
    <style>
        :root {
            --cor-lotofacil: #8b008b;
            --cor-megasena: #209869;
            --bg-body: #f0f2f5;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        #modalCustom { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 12px; text-align: center; max-width: 320px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .modal-btns { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn-modal { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; flex: 1; }
        .lf-theme .btn-sim { background: var(--cor-lotofacil); color: white; }
        .ms-theme .btn-sim { background: var(--cor-megasena); color: white; }
        .btn-nao { background: #eee; color: #333; }

        .menu-loterias { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 500px; }
        .btn-aba { flex: 1; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; color: white; transition: 0.3s; opacity: 0.6; text-transform: uppercase; }
        .btn-aba.active { opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .aba-lotofacil { background-color: var(--cor-lotofacil); }
        .aba-megasena { background-color: var(--cor-megasena); }

        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 500px; width: 100%; display: none; }
        .container.active { display: block; }

        h2 { text-align: center; margin-bottom: 5px; }
        .busca-concurso { display: flex; gap: 5px; margin-bottom: 15px; justify-content: center; align-items: center; }
        .busca-concurso input { width: 100px; padding: 8px; border: 2px solid #ddd; border-radius: 5px; text-align: center; font-size: 16px; font-weight: bold; }
        .btn-nav { color: white; border: none; border-radius: 5px; width: 35px; height: 38px; cursor: pointer; font-weight: bold; font-size: 20px; }
        .btn-busca { background: #666; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; height: 38px; }

        .concurso-info { text-align: center; font-size: 0.95em; color: #333; font-weight: bold; margin-bottom: 10px; min-height: 20px; }
        .bolas-container { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .bola { width: 32px; height: 32px; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        
        .lf-theme .bola { background: var(--cor-lotofacil); }
        .lf-theme .bolas-container { background: #f8f0f8; }
        .ms-theme .bola { background: var(--cor-megasena); }
        .ms-theme .bolas-container { background: #f0f8f4; }
        
        .resumo-geral { border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 0.9em; text-align: center; line-height: 1.6; }
        .lf-theme .resumo-geral { background: #eef2ff; border: 1px solid #c7d2fe; color: #3730a3; }
        .ms-theme .resumo-geral { background: #e6fffa; border: 1px solid #b2f5ea; color: #234e52; }
        
        /* CAIXA DO RESUMO MAIS CLARA */
        .caixa-acerto { background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(0, 0, 0, 0.03); border-radius: 6px; padding: 4px 12px; display: inline-block; margin: 4px 2px; }

        .add-jogo-section { background: #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-jogo-section input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        
        .btn { border: none; border-radius: 5px; cursor: pointer; font-weight: bold; padding: 10px; transition: 0.3s; width: 100%; }
        .btn-add-lf { background: var(--cor-lotofacil); color: white; }
        .btn-add-ms { background: var(--cor-megasena); color: white; }
        .btn-random { background: #555; color: white; font-size: 0.85em; margin-top: 5px; }
        .btn-limpar { background: #ff4444; color: white; margin-top: 10px; opacity: 0.7; }
        
        .aviso-legal { margin-top: 15px; font-size: 11px; color: #777; text-align: center; line-height: 1.4; padding: 10px; border-top: 1px dashed #ccc; }

        .card-jogo { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 10px; position: relative; }
        .premiado { background-color: #d4edda !important; border: 2px solid #28a745 !important; }
        .badge-premio { background: #28a745; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-left: 10px; }

        .remove-btn { position: absolute; top: 5px; right: 5px; color: #999; cursor: pointer; border: none; background: none; font-weight: bold; }
        .num-acertado-lf { color: var(--cor-lotofacil); font-weight: bold; background: #fdf0fd; border-bottom: 2px solid var(--cor-lotofacil); }
        .num-acertado-ms { color: var(--cor-megasena); font-weight: bold; background: #f0fdf4; border-bottom: 2px solid var(--cor-megasena); }
    </style>
</head>
<body class="lf-theme">

    <div id="modalCustom">
        <div class="modal-content">
            <p id="modalMsg" style="font-weight: bold; color: #333;"></p>
            <div class="modal-btns">
                <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
                <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="menu-loterias">
        <button class="btn-aba aba-lotofacil active" onclick="switchTab('lotofacil')">Lotof√°cil</button>
        <button class="btn-aba aba-megasena" onclick="switchTab('megasena')">Mega-Sena</button>
    </div>

    <div id="cont-lotofacil" class="container active lf-theme">
        <h2 style="color:var(--cor-lotofacil)">Lotof√°cil</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', -1)">-</button>
            <input type="number" id="numLF" placeholder="N¬∫">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', 1)">+</button>
            <button class="btn-busca" onclick="buscar('lotofacil', document.getElementById('numLF').value)">Buscar</button>
        </div>
        <p id="infoLF" class="concurso-info">Carregando...</p>
        <div id="bolasLF" class="bolas-container"></div>
        <div id="resumoLF" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputLF" placeholder="Digite de 15 a 20 n√∫meros">
            <button class="btn btn-add-lf" onclick="adicionarJogo('lotofacil')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('lotofacil')">üé≤ Gerar Surpresinha (15 n√∫meros)</button>
        </div>

        <div id="listaLF"></div>
        <button class="btn btn-limpar" onclick="confirmarLimpar('lotofacil')">Apagar Tudo</button>
        
        <div class="aviso-legal">
            ‚ö†Ô∏è <b>Aviso:</b> Este site √© uma ferramenta independente para facilitar a confer√™ncia de jogos. N√£o nos responsabilizamos por eventuais inconsist√™ncias nos resultados apresentados. Este site <b>n√£o garante pr√™mios</b> e n√£o possui v√≠nculo com a Caixa Econ√¥mica Federal. <b>Sempre confira seu bilhete oficial.</b>
        </div>
    </div>

    <div id="cont-megasena" class="container ms-theme">
        <h2 style="color:var(--cor-megasena)">Mega-Sena</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', -1)">-</button>
            <input type="number" id="numMS" placeholder="N¬∫">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', 1)">+</button>
            <button class="btn-busca" onclick="buscar('megasena', document.getElementById('numMS').value)">Buscar</button>
        </div>
        <p id="infoMS" class="concurso-info">Carregando...</p>
        <div id="bolasMS" class="bolas-container"></div>
        <div id="resumoMS" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputMS" placeholder="Digite de 6 a 20 n√∫meros">
            <button class="btn btn-add-ms" onclick="adicionarJogo('megasena')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('megasena')">üé≤ Gerar Surpresinha (6 n√∫meros)</button>
        </div>

        <div id="listaMS"></div>
        <button class="btn btn-limpar" onclick="confirmarLimpar('megasena')">Apagar Tudo</button>

        <div class="aviso-legal">
            ‚ö†Ô∏è <b>Aviso:</b> Este site √© uma ferramenta independente para facilitar a confer√™ncia de jogos. N√£o nos responsabilizamos por eventuais inconsist√™ncias nos resultados apresentados. Este site <b>n√£o garante pr√™mios</b> e n√£o possui v√≠nculo com a Caixa Econ√¥mica Federal. <b>Sempre confira seu bilhete oficial.</b>
        </div>
    </div>

<script>
    let dados = {
        lotofacil: { ganhadores: [], meusJogos: JSON.parse(localStorage.getItem('jogos_LF')) || [], api: 'lotofacil', min: 15, max: 20, max_bolas: 15, range: 25 },
        megasena: { ganhadores: [], meusJogos: JSON.parse(localStorage.getItem('jogos_MS')) || [], api: 'megasena', min: 6, max: 20, max_bolas: 6, range: 60 }
    };

    function exibirModal(msg, callback, apenasAviso = false) {
        const modal = document.getElementById('modalCustom');
        const msgEl = document.getElementById('modalMsg');
        const btnSim = document.getElementById('btnSim');
        const btnNao = document.getElementById('btnNao');
        msgEl.innerText = msg;
        modal.style.display = 'flex';
        btnNao.style.display = apenasAviso ? 'none' : 'block';
        btnSim.innerText = apenasAviso ? 'OK' : 'Confirmar';
        btnSim.onclick = () => { modal.style.display = 'none'; if (callback) callback(); };
        btnNao.onclick = () => { modal.style.display = 'none'; };
    }

    function switchTab(tipo) {
        document.querySelectorAll('.container, .btn-aba').forEach(el => el.classList.remove('active'));
        document.getElementById(`cont-${tipo}`).classList.add('active');
        document.querySelector(`.aba-${tipo}`).classList.add('active');
        document.body.className = `${tipo === 'lotofacil' ? 'lf' : 'ms'}-theme`;
    }

    async function buscar(tipo, concurso = 'latest') {
        const idInfo = tipo === 'lotofacil' ? 'infoLF' : 'infoMS';
        const idInput = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        const idBolas = tipo === 'lotofacil' ? 'bolasLF' : 'bolasMS';
        try {
            const termo = (concurso === '' || concurso === null) ? 'latest' : concurso;
            const response = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/${termo}`);
            if (!response.ok) throw new Error();
            const data = await response.json();
            document.getElementById(idInput).value = data.concurso;
            dados[tipo].ganhadores = data.dezenas.map(Number);
            document.getElementById(idInfo).innerHTML = `Concurso ${data.concurso} - Data: ${data.data}`;
            const bolasEl = document.getElementById(idBolas);
            bolasEl.innerHTML = '';
            data.dezenas.forEach(num => { bolasEl.innerHTML += `<div class="bola">${num}</div>`; });
            renderizar(tipo);
        } catch (e) {
            document.getElementById(idInfo).innerHTML = `<span style="color:#d93025">‚ö†Ô∏è CONCURSO N√ÉO ENCONTRADO OU N√ÉO SORTEADO</span>`;
            renderizar(tipo);
        }
    }

    function navegarConcurso(tipo, direcao) {
        const id = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        let val = parseInt(document.getElementById(id).value);
        if(!isNaN(val)) buscar(tipo, val + direcao);
    }

    function gerarSurpresinha(tipo) {
        let numeros = [];
        while(numeros.length < dados[tipo].min) {
            let n = Math.floor(Math.random() * dados[tipo].range) + 1;
            if(!numeros.includes(n)) numeros.push(n);
        }
        numeros.sort((a,b) => a - b);
        dados[tipo].meusJogos.push(numeros);
        localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
        renderizar(tipo);
    }

    function adicionarJogo(tipo) {
        const input = document.getElementById(tipo === 'lotofacil' ? 'inputLF' : 'inputMS');
        let nums = input.value.split(/[\s,]+/).filter(n => n !== "").map(Number);
        let unicos = [...new Set(nums)];
        if (unicos.length !== nums.length) { exibirModal("‚ö†Ô∏è Aten√ß√£o: N√∫meros repetidos detectados no jogo!", null, true); return; }
        if (unicos.length < dados[tipo].min || unicos.length > dados[tipo].max) { exibirModal(`Aviso: Digite entre ${dados[tipo].min} e ${dados[tipo].max} n√∫meros.`, null, true); return; }
        unicos.sort((a,b) => a-b);
        dados[tipo].meusJogos.push(unicos);
        localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
        input.value = '';
        renderizar(tipo);
    }

    function confirmarRemover(tipo, index) {
        exibirModal("Deseja excluir este jogo?", () => {
            dados[tipo].meusJogos.splice(index, 1);
            localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
            renderizar(tipo);
        });
    }

    function confirmarLimpar(tipo) {
        exibirModal(`Deseja apagar todos os jogos de ${tipo}?`, () => {
            dados[tipo].meusJogos = [];
            localStorage.removeItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS');
            renderizar(tipo);
        });
    }

    function renderizar(tipo) {
        const lista = document.getElementById(tipo === 'lotofacil' ? 'listaLF' : 'listaMS');
        const resumo = document.getElementById(tipo === 'lotofacil' ? 'resumoLF' : 'resumoMS');
        const classeAcerto = tipo === 'lotofacil' ? 'num-acertado-lf' : 'num-acertado-ms';
        lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>';
        let stats = {};
        let totalPremiados = 0;
        
        if (dados[tipo].meusJogos.length === 0) { 
            resumo.innerHTML = "Nenhum jogo salvo."; 
            return; 
        }

        dados[tipo].meusJogos.forEach((jogo, idx) => {
            const acertos = jogo.filter(n => dados[tipo].ganhadores.includes(n)).length;
            stats[acertos] = (stats[acertos] || 0) + 1;
            const ganhou = acertos >= (tipo === 'lotofacil' ? 11 : 4) && dados[tipo].ganhadores.length > 0;
            if(ganhou) totalPremiados++;
            
            const htmlJogo = jogo.map(n => {
                const s = n.toString().padStart(2, '0');
                return (dados[tipo].ganhadores.includes(n)) ? `<span class="${classeAcerto}">${s}</span>` : s;
            }).join(' ');
            
            lista.innerHTML += `<div class="card-jogo ${ganhou ? 'premiado' : ''}">
                <button class="remove-btn" onclick="confirmarRemover('${tipo}', ${idx})">X</button>
                <div style="font-family: monospace; font-size: 1.1em; margin-bottom:5px;">${htmlJogo}</div>
                <small><b>${acertos} ACERTOS</b> ${ganhou ? '<span class="badge-premio">GANHOU!</span>' : ''}</small>
            </div>`;
        });

        if (dados[tipo].ganhadores.length > 0) {
            if (totalPremiados > 0) {
                let resumoHtml = `<strong>üéâ PARAB√âNS! ${totalPremiados} jogo(s) premiado(s)!</strong><br>`;
                resumoHtml += `<strong>Resumo do Concurso:</strong><br>`;
                
                const faixas = tipo === 'lotofacil' ? [15,14,13,12,11] : [6,5,4];
                faixas.forEach(f => {
                    if (stats[f]) {
                        resumoHtml += `<div class="caixa-acerto">${stats[f]} jogo(s) de <b>${f} acertos</b></div><br>`;
                    }
                });
                resumo.innerHTML = resumoHtml;
            } else {
                resumo.innerHTML = "Nenhum jogo premiado neste concurso.";
            }
        } else {
            resumo.innerHTML = "Aguardando resultado...";
        }
    }

    window.onload = () => { buscar('lotofacil'); buscar('megasena'); };
</script>
</body>
</html>
