<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Loterias Pro - Vers√£o 3.0</title>
    <style>
        :root {
            --cor-lotofacil: #8b008b;
            --cor-megasena: #209869;
            --bg-body: #f0f2f5;
        }

        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg-body); display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .menu-loterias { display: flex; gap: 10px; margin-bottom: 20px; width: 100%; max-width: 500px; }
        .btn-aba { flex: 1; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 14px; color: white; transition: 0.3s; opacity: 0.6; text-transform: uppercase; }
        .btn-aba.active { opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .aba-lotofacil { background-color: var(--cor-lotofacil); }
        .aba-megasena { background-color: var(--cor-megasena); }

        .container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); max-width: 500px; width: 100%; display: none; }
        .container.active { display: block; }

        h2 { text-align: center; margin-bottom: 5px; }
        .busca-concurso { display: flex; gap: 5px; margin-bottom: 15px; justify-content: center; align-items: center; }
        .busca-concurso input { width: 100px; padding: 8px; border: 2px solid #ddd; border-radius: 5px; text-align: center; font-size: 16px; font-weight: bold; }
        .btn-nav { color: white; border: none; border-radius: 5px; width: 35px; height: 38px; cursor: pointer; font-weight: bold; font-size: 20px; }
        .btn-busca { background: #666; color: white; padding: 5px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; height: 38px; }

        .concurso-info { text-align: center; font-size: 0.95em; color: #333; font-weight: bold; margin-bottom: 10px; min-height: 20px; }
        .erro-msg { color: #ff4444; background: #ffebeb; padding: 5px; border-radius: 5px; display: inline-block; border: 1px solid #ffcccc; }
        
        .bolas-container { display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; padding: 10px; border-radius: 8px; margin-bottom: 10px; }
        .bola { width: 32px; height: 32px; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        
        .lf-theme .bola { background: var(--cor-lotofacil); }
        .lf-theme .bolas-container { background: #f8f0f8; }
        .ms-theme .bola { background: var(--cor-megasena); }
        .ms-theme .bolas-container { background: #f0f8f4; }
        
        .resumo-geral { border-radius: 8px; padding: 12px; margin-bottom: 20px; font-size: 0.9em; text-align: center; line-height: 1.6; }
        .lf-theme .resumo-geral { background: #eef2ff; border: 1px solid #c7d2fe; color: #3730a3; }
        .ms-theme .resumo-geral { background: #e6fffa; border: 1px solid #b2f5ea; color: #234e52; }

        .add-jogo-section { background: #eee; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px; }
        .add-jogo-section input { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box; font-size: 16px; }
        
        .btn { border: none; border-radius: 5px; cursor: pointer; font-weight: bold; padding: 10px; transition: 0.3s; width: 100%; }
        .btn-add-lf { background: var(--cor-lotofacil); color: white; }
        .btn-add-ms { background: var(--cor-megasena); color: white; }
        .btn-random { background: #555; color: white; font-size: 0.9em; margin-top: 5px; }
        .btn-limpar { background: #ff4444; color: white; margin-top: 10px; opacity: 0.7; }
        
        .card-jogo { background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 8px; margin-bottom: 10px; position: relative; }
        .premiado { background-color: #d4edda !important; border: 2px solid #28a745 !important; }
        .badge-premio { background: #28a745; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; margin-left: 10px; }

        .remove-btn { position: absolute; top: 5px; right: 5px; color: #999; cursor: pointer; border: none; background: none; font-weight: bold; }
        .num-acertado-lf { color: var(--cor-lotofacil); font-weight: bold; background: #fdf0fd; border-bottom: 2px solid var(--cor-lotofacil); }
        .num-acertado-ms { color: var(--cor-megasena); font-weight: bold; background: #f0fdf4; border-bottom: 2px solid var(--cor-megasena); }
    </style>
</head>
<body class="lf-theme">

    <div class="menu-loterias">
        <button class="btn-aba aba-lotofacil active" onclick="switchTab('lotofacil')">Lotof√°cil</button>
        <button class="btn-aba aba-megasena" onclick="switchTab('megasena')">Mega-Sena</button>
    </div>

    <div id="cont-lotofacil" class="container active lf-theme">
        <h2 style="color:var(--cor-lotofacil)">Lotof√°cil</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', -1)">-</button>
            <input type="number" id="numLF" placeholder="N¬∫">
            <button class="btn-nav aba-lotofacil" onclick="navegarConcurso('lotofacil', 1)">+</button>
            <button class="btn-busca" onclick="buscar('lotofacil', document.getElementById('numLF').value)">Buscar</button>
        </div>
        <p id="infoLF" class="concurso-info">Carregando...</p>
        <div id="bolasLF" class="bolas-container"></div>
        <div id="resumoLF" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputLF" placeholder="Digite de 15 a 20 n√∫meros">
            <button class="btn btn-add-lf" onclick="adicionarJogo('lotofacil')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('lotofacil')">üé≤ Gerar Surpresinha (15 n√∫meros)</button>
        </div>

        <div id="listaLF"></div>
        <button class="btn btn-limpar" onclick="limpar('lotofacil')">Apagar Tudo</button>
    </div>

    <div id="cont-megasena" class="container ms-theme">
        <h2 style="color:var(--cor-megasena)">Mega-Sena</h2>
        <div class="busca-concurso">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', -1)">-</button>
            <input type="number" id="numMS" placeholder="N¬∫">
            <button class="btn-nav aba-megasena" onclick="navegarConcurso('megasena', 1)">+</button>
            <button class="btn-busca" onclick="buscar('megasena', document.getElementById('numMS').value)">Buscar</button>
        </div>
        <p id="infoMS" class="concurso-info">Carregando...</p>
        <div id="bolasMS" class="bolas-container"></div>
        <div id="resumoMS" class="resumo-geral">Aguardando...</div>
        
        <div class="add-jogo-section">
            <label><b>Cadastrar Jogo:</b></label>
            <input type="text" id="inputMS" placeholder="Digite de 6 a 20 n√∫meros">
            <button class="btn btn-add-ms" onclick="adicionarJogo('megasena')">Salvar Jogo na Lista</button>
            <button class="btn btn-random" onclick="gerarSurpresinha('megasena')">üé≤ Gerar Surpresinha (6 n√∫meros)</button>
        </div>

        <div id="listaMS"></div>
        <button class="btn btn-limpar" onclick="limpar('megasena')">Apagar Tudo</button>
    </div>

<script>
    let dados = {
        lotofacil: { ganhadores: [], meusJogos: JSON.parse(localStorage.getItem('jogos_LF')) || [], api: 'lotofacil', min: 15, max: 20, max_bolas: 15, range: 25 },
        megasena: { ganhadores: [], meusJogos: JSON.parse(localStorage.getItem('jogos_MS')) || [], api: 'megasena', min: 6, max: 20, max_bolas: 6, range: 60 }
    };

    function switchTab(tipo) {
        document.querySelectorAll('.container, .btn-aba').forEach(el => el.classList.remove('active'));
        document.getElementById(`cont-${tipo}`).classList.add('active');
        document.querySelector(`.aba-${tipo}`).classList.add('active');
        document.body.className = `${tipo === 'lotofacil' ? 'lf' : 'ms'}-theme`;
    }

    async function buscar(tipo, concurso = 'latest') {
        const idInfo = tipo === 'lotofacil' ? 'infoLF' : 'infoMS';
        const idInput = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        const idBolas = tipo === 'lotofacil' ? 'bolasLF' : 'bolasMS';
        const infoEl = document.getElementById(idInfo);
        const bolasEl = document.getElementById(idBolas);

        try {
            const termo = (concurso === '' || concurso === null) ? 'latest' : concurso;
            const response = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/${termo}`);
            
            if (!response.ok) throw new Error("inexistente");
            
            const data = await response.json();
            document.getElementById(idInput).value = data.concurso;
            dados[tipo].ganhadores = data.dezenas.map(Number);
            infoEl.innerHTML = `Concurso ${data.concurso} - Data: ${data.data}`;
            
            bolasEl.innerHTML = '';
            data.dezenas.forEach(num => {
                bolasEl.innerHTML += `<div class="bola">${num}</div>`;
            });
            
            renderizar(tipo);
        } catch (e) {
            infoEl.innerHTML = `<span class="erro-msg">‚ö†Ô∏è CONCURSO N√ÉO EXISTE OU N√ÉO SORTEADO</span>`;
            dados[tipo].ganhadores = [];
            bolasEl.innerHTML = '';
            for(let i=0; i<dados[tipo].max_bolas; i++) {
                bolasEl.innerHTML += `<div class="bola" style="opacity:0.3">--</div>`;
            }
            renderizar(tipo);
        }
    }

    function navegarConcurso(tipo, direcao) {
        const id = tipo === 'lotofacil' ? 'numLF' : 'numMS';
        let val = parseInt(document.getElementById(id).value);
        if(!isNaN(val)) buscar(tipo, val + direcao);
    }

    function gerarSurpresinha(tipo) {
        let numeros = [];
        const qtd = dados[tipo].min;
        const limite = dados[tipo].range;

        while(numeros.length < qtd) {
            let n = Math.floor(Math.random() * limite) + 1;
            if(!numeros.includes(n)) numeros.push(n);
        }
        numeros.sort((a,b) => a - b);
        
        if (dados[tipo].meusJogos.some(j => j.join('-') === numeros.join('-'))) {
            gerarSurpresinha(tipo);
            return;
        }

        dados[tipo].meusJogos.push(numeros);
        localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
        renderizar(tipo);
    }

    function adicionarJogo(tipo) {
        const input = document.getElementById(tipo === 'lotofacil' ? 'inputLF' : 'inputMS');
        let numerosBrutos = input.value.split(/[\s,]+/).filter(n => n !== "").map(Number);
        
        // 1. Verificar se h√° n√∫meros repetidos no mesmo jogo
        let numerosUnicos = [...new Set(numerosBrutos)];
        if (numerosUnicos.length !== numerosBrutos.length) {
            alert("‚ö†Ô∏è Erro: Existem n√∫meros repetidos dentro do seu jogo. Verifique e tente novamente.");
            return;
        }

        numerosUnicos.sort((a,b) => a - b);
        
        // 2. Verificar limites de quantidade
        if (numerosUnicos.length < dados[tipo].min || numerosUnicos.length > dados[tipo].max) { 
            alert(`Erro: O jogo da ${tipo} deve ter entre ${dados[tipo].min} e ${dados[tipo].max} n√∫meros.`); 
            return; 
        }

        // 3. Verificar se o jogo j√° existe na lista salva
        const jaExiste = dados[tipo].meusJogos.some(j => j.join('-') === numerosUnicos.join('-'));
        if (jaExiste) {
            alert("‚ö†Ô∏è JOGO J√Å CADASTRADO NA LISTA!");
            return;
        }

        dados[tipo].meusJogos.push(numerosUnicos);
        localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
        input.value = '';
        renderizar(tipo);
    }

    function removerJogo(tipo, index) {
        dados[tipo].meusJogos.splice(index, 1);
        localStorage.setItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS', JSON.stringify(dados[tipo].meusJogos));
        renderizar(tipo);
    }

    function limpar(tipo) {
        if(confirm(`Apagar todos os jogos?`)) {
            dados[tipo].meusJogos = [];
            localStorage.removeItem(tipo === 'lotofacil' ? 'jogos_LF' : 'jogos_MS');
            renderizar(tipo);
        }
    }

    function renderizar(tipo) {
        const lista = document.getElementById(tipo === 'lotofacil' ? 'listaLF' : 'listaMS');
        const resumo = document.getElementById(tipo === 'lotofacil' ? 'resumoLF' : 'resumoMS');
        const classeAcerto = tipo === 'lotofacil' ? 'num-acertado-lf' : 'num-acertado-ms';
        const minPremio = tipo === 'lotofacil' ? 11 : 4;

        lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>';
        let stats = {};
        let totalPremiados = 0;
        
        if (dados[tipo].meusJogos.length === 0) {
            resumo.innerHTML = "Nenhum jogo salvo.";
            return;
        }

        dados[tipo].meusJogos.forEach((jogo, idx) => {
            const acertos = jogo.filter(n => dados[tipo].ganhadores.includes(n)).length;
            stats[acertos] = (stats[acertos] || 0) + 1;
            const ganhou = acertos >= minPremio && dados[tipo].ganhadores.length > 0;
            if(ganhou) totalPremiados++;

            const htmlJogo = jogo.map(n => {
                const s = n.toString().padStart(2, '0');
                return (dados[tipo].ganhadores.includes(n)) ? `<span class="${classeAcerto}">${s}</span>` : s;
            }).join(' ');

            lista.innerHTML += `
                <div class="card-jogo ${ganhou ? 'premiado' : ''}">
                    <button class="remove-btn" onclick="removerJogo('${tipo}', ${idx})">X</button>
                    <div style="font-family: monospace; font-size: 1.1em; margin-bottom:5px; line-height: 1.4;">${htmlJogo}</div>
                    <small><b>${acertos} ACERTOS</b> ${ganhou ? '<span class="badge-premio">GANHOU!</span>' : ''}</small>
                </div>`;
        });

        if (dados[tipo].ganhadores.length === 0) {
            resumo.innerHTML = "Aguardando resultado para conferir...";
            return;
        }

        let htmlRes = `<strong>Resumo do Concurso:</strong><br>`;
        let temPremio = false;
        const faixas = tipo === 'lotofacil' ? [15,14,13,12,11] : [6,5,4];
        
        faixas.forEach(f => {
            if(stats[f]) {
                htmlRes += `<span style="display:inline-block; margin: 5px; padding: 2px 8px; border:1px solid #ddd; background:#fff; border-radius:4px;">${stats[f]} jogo(s) de <b>${f} acertos</b></span>`;
                temPremio = true;
            }
        });

        resumo.innerHTML = temPremio ? `<strong>üéâ PARAB√âNS! ${totalPremiados} jogo(s) premiado(s)!</strong><br>${htmlRes}` : "Nenhum jogo premiado neste concurso.";
    }

    window.onload = () => {
        buscar('lotofacil');
        buscar('megasena');
    };
</script>
</body>
</html>
