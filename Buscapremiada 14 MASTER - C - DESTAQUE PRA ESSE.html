<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel LotoF√°cil Pro - Scanner Autom√°tico</title>
    
    <!-- √çcone do aplicativo - Trevo üçÄ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÄ</text></svg>">
    
    <!-- Para dispositivos Apple -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçÄ</text></svg>">
    
    <style>
        :root {
            --cor-lotofacil: #8b008b;
            --bg-body: #f0f2f5;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-body);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Container principal com duas colunas */
        .main-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            flex-wrap: wrap;
        }
        
        /* Coluna esquerda - Scanner */
        .left-column {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }
        
        /* Coluna direita - C√≥digo Principal */
        .right-column {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
        }
        
        /* Ajustes para mobile */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }
            
            .left-column, .right-column {
                max-width: 100%;
                width: 100%;
            }
        }
        
        #modalCustom {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-btns {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .btn-modal {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            min-width: 80px;
        }
        .btn-sim {
            background: var(--cor-lotofacil);
            color: white;
        }
        .btn-nao {
            background: #eee;
            color: #333;
        }
        .container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }
        h2 {
            text-align: center;
            margin-bottom: 5px;
            color: var(--cor-lotofacil);
        }
        .busca-concurso {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            justify-content: center;
            align-items: center;
        }
        .busca-concurso input {
            width: 100px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-nav {
            background: var(--cor-lotofacil);
            color: white;
            border: none;
            border-radius: 5px;
            width: 35px;
            height: 38px;
            cursor: pointer;
            font-weight: bold;
            font-size: 20px;
        }
        .btn-busca {
            background: #666;
            color: white;
            padding: 5px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            height: 38px;
        }
        .concurso-info {
            text-align: center;
            font-size: 0.95em;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
            min-height: 20px;
        }
        .bolas-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
            padding: 10px;
            background: #f8f0f8;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .bola {
            width: 32px;
            height: 32px;
            background: var(--cor-lotofacil);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }
        .resumo-geral {
            background: #eef2ff;
            border: 1px solid #c7d2fe;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 20px;
            font-size: 0.9em;
            text-align: center;
            line-height: 1.6;
            color: #3730a3;
        }
        .caixa-acerto {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.03);
            border-radius: 6px;
            padding: 4px 12px;
            display: inline-block;
            margin: 4px 2px;
        }
        .add-jogo-section {
            background: #eee;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .add-jogo-section input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .btn {
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            padding: 10px;
            transition: 0.3s;
            width: 100%;
        }
        .btn-add-lf {
            background: var(--cor-lotofacil);
            color: white;
        }
        .btn-random {
            background: #555;
            color: white;
            font-size: 0.85em;
            margin-top: 5px;
        }
        .btn-limpar {
            background: #ff4444;
            color: white;
            margin-top: 10px;
            opacity: 0.7;
        }
        .secao-memoria {
            background: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        .grid-memoria {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin-top: 10px;
        }
        .btn-memoria {
            padding: 8px 2px;
            font-size: 11px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }
        .btn-memoria:hover {
            background: #eee;
        }
        .btn-memoria.slot-active {
            background: #444;
            color: #fff;
            border-color: #000;
            transform: scale(1.05);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-memoria.slot-vazio {
            background: #f0f0f0;
            color: #888;
            border-color: #ddd;
            font-style: italic;
        }
        .btn-guardar {
            width: 100%;
            font-size: 12px;
            padding: 8px;
            background: #444;
            color: white;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }
        .badge-vitorias {
            background: #ffd700;
            color: #000;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            border: 1px solid #daa520;
            font-weight: 900;
        }
        .badge-doze {
            background: #00c3ff;
            color: #fff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            border: 1px solid #0096c7;
            font-weight: 900;
        }
        .badge-treze {
            background: #3730a3;
            color: #fff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            border: 1px solid #1e1b4b;
            font-weight: 900;
        }
        .badge-onze {
            background: #ff8c00;
            color: #fff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 900;
        }
        .badge-dinheiro {
            background: #209869;
            color: #fff;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 900;
        }
        .painel-financeiro {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            background: #fff;
            border: 1px solid #ddd;
        }
        .financeiro-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .financeiro-total {
            border-top: 1px solid #eee;
            margin-top: 10px;
            padding-top: 10px;
            font-weight: bold;
            font-size: 16px;
        }
        .lucro {
            color: #209869;
        }
        .prejuizo {
            color: #d93025;
        }
        .contagem-especial {
            margin-top: 10px;
            padding: 12px;
            background: #fffde7;
            border: 1px solid #fbc02d;
            border-radius: 10px;
            font-size: 14px;
            color: #5d4037;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .aviso-legal {
            margin-top: 15px;
            font-size: 11px;
            color: #777;
            text-align: center;
            line-height: 1.4;
            padding: 10px;
            border-top: 1px dashed #ccc;
        }
        .card-jogo {
            background: #fff;
            border: 1px solid #ddd;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            position: relative;
        }
        .premiado {
            background-color: #d4edda !important;
            border: 2px solid #28a745 !important;
        }
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            color: #999;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: bold;
        }
        .num-acertado-lf {
            color: var(--cor-lotofacil);
            font-weight: bold;
            background: #fdf0fd;
            border-bottom: 2px solid var(--cor-lotofacil);
        }
        .progress-container {
            width: 100%;
            background-color: #ddd;
            border-radius: 10px;
            margin-top: 8px;
            display: none;
            height: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #f39c12;
            width: 0%;
            transition: width 0.1s;
        }
        .aviso-link {
            color: #0e9f6e;
            text-decoration: none;
            font-weight: bold;
        }
        .btn-high-performance {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            font-size: 0.85em;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            padding: 10px;
            transition: 0.3s;
            width: 100%;
        }
        .btn-high-performance:hover {
            background: linear-gradient(45deg, #ee5a24, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-transferir {
            background: linear-gradient(45deg, #209869, #1e824c);
            color: white;
            font-size: 0.85em;
            margin-top: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            padding: 10px;
            transition: 0.3s;
            width: 100%;
        }
        .btn-transferir:hover {
            background: linear-gradient(45deg, #1e824c, #209869);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* Container do Scanner */
        .scanner-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            box-sizing: border-box;
        }
        
        .scanner-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .scanner-header h2 {
            color: #9b2a92;
            margin: 0;
            font-size: 20px;
            line-height: 1.3;
            flex: 1;
            text-align: left;
        }
        
        /* Configura√ß√£o dos novos campos de busca */
        .busca-config {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .busca-config .campo-duplo {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .busca-config .campo {
            flex: 1;
            min-width: 120px;
        }
        
        .busca-config label {
            display: block;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 3px;
            text-transform: uppercase;
            opacity: 0.9;
        }
        
        .busca-config input {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 2px solid white;
            background: rgba(255,255,255,0.9);
            font-weight: bold;
            color: #333;
            box-sizing: border-box;
        }
        
        .busca-config input:focus {
            outline: none;
            background: white;
        }
        
        .busca-config input::placeholder {
            color: #999;
            font-size: 12px;
        }
        
        .criterio-selector {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .criterio-selector label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .criterio-selector select {
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid white;
            background: rgba(255,255,255,0.9);
            font-weight: bold;
            color: #333;
            cursor: pointer;
            min-width: 120px;
        }
        
        .criterio-selector select:hover {
            background: white;
        }

        /* Modal de Confirma√ß√£o do Scanner */
        .modal-scanner-confirm {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 10002;
            align-items: center;
            justify-content: center;
        }
        
        .modal-scanner-confirm-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .modal-scanner-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .btn-scanner-modal {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-scanner-confirm {
            background: #4CAF50;
            color: white;
        }
        
        .btn-scanner-cancel {
            background: #f44336;
            color: white;
        }
        
        .btn-scanner-add {
            background: #2196F3;
            color: white;
        }

        .tooltip-box {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(10px);
            background: #2c3e50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            white-space: nowrap;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-align: center;
            min-width: 180px;
        }

        .tooltip-box:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #2c3e50;
        }

        .tooltip-box.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
            pointer-events: auto;
        }

        /* Modal para selecionar n√∫meros */
        #modalNumeros {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }

        .modal-numeros-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .numeros-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .numero-btn {
            width: 45px;
            height: 45px;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .numero-btn:hover {
            transform: scale(1.1);
        }

        .numero-btn.selecionado {
            background: var(--cor-lotofacil);
            color: white;
            border-color: var(--cor-lotofacil);
        }

        .contador-selecionados {
            text-align: center;
            font-weight: bold;
            margin: 15px 0;
            color: #333;
        }

        .btn-confirmar-numeros {
            background: var(--cor-lotofacil);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }

        .btn-slot-vazio {
            background: #888 !important;
            color: white;
            opacity: 0.8;
        }

        .btn-slot-vazio:hover {
            opacity: 1;
        }

        .percentual-status {
            margin-left: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .percentual-status.positivo {
            color: #2196F3;
        }

        .percentual-status.positivo::before {
            content: "+";
            margin-right: 2px;
        }

        .percentual-status.negativo {
            color: #f44336;
        }

        .percentual-status.negativo::before {
            content: "-";
            margin-right: 2px;
        }

        .percentual-status.zero {
            color: #666;
        }

        .contagem-numeros-sorteados {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .contagem-numeros-sorteados h3 {
            color: #495057;
            font-size: 14px;
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
        }

        .grid-numeros-sorteados {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .numero-sorteado-item {
            background: white;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 6px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .numero-sorteado-item span.numero {
            display: block;
            font-size: 14px;
            color: #212529;
        }

        .numero-sorteado-item span.contagem {
            display: block;
            font-size: 10px;
            color: #6c757d;
        }

        .numero-sorteado-item .contagem.destaque {
            color: var(--cor-lotofacil);
            font-weight: bold;
        }

        /* Modal para contagem do jogo */
        #modalContagemJogo {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
        }

        .modal-contagem-content {
            background: white;
            padding: 20px;
            border-radius: 15px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-contagem-content h3 {
            color: var(--cor-lotofacil);
            text-align: center;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .grid-contagem-jogo {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .numero-contagem-item {
            background: white;
            border: 1px solid #ced4da;
            border-radius: 6px;
            padding: 6px;
            text-align: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .numero-contagem-item span.numero {
            display: block;
            font-size: 14px;
            color: #212529;
        }

        .numero-contagem-item span.contagem {
            display: block;
            font-size: 10px;
            color: var(--cor-lotofacil);
            font-weight: bold;
        }

        .btn-fechar-modal {
            background: #666;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
        }

        .btn-ver-contagem {
            background: var(--cor-lotofacil);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 10px;
            cursor: pointer;
            margin-left: 5px;
            font-weight: bold;
        }

        .btn-ver-contagem:hover {
            opacity: 0.9;
        }
        
        /* Badge para jogos com vit√≥rias */
        .badge-onze-plus {
            background: #ff4500;
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: 900;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background: #ff6347; }
            100% { transform: scale(1); }
        }
        
        /* Status do loop autom√°tico */
        .loop-status {
            background: #1a202c;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 13px;
            text-align: center;
            display: none;
        }
        
        .loop-status .destaque {
            color: #ffd700;
            font-weight: bold;
        }
        
        .loop-status .sucesso {
            color: #4caf50;
            font-weight: bold;
        }
    </style>
</head>
<body class="lf-theme">
    <div id="modalCustom">
        <div class="modal-content">
            <p id="modalMsg" style="font-weight: bold; color: #333;"></p>
            <div id="modalContainerBotoes" class="modal-btns">
                <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
                <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para selecionar n√∫meros -->
    <div id="modalNumeros">
        <div class="modal-numeros-content">
            <h3 style="color: var(--cor-lotofacil); text-align: center; margin-bottom: 15px;">Selecione os N√∫meros</h3>
            <div class="contador-selecionados" id="contadorSelecionados">Selecionados: 0/15</div>
            <div class="numeros-grid" id="numerosGrid"></div>
            <div style="text-align: center; margin: 15px 0;">
                <button onclick="limparSelecaoNumeros()" style="background: #ff4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-right: 10px;">Limpar</button>
                <button onclick="fecharModalNumeros()" style="background: #666; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">Cancelar</button>
            </div>
            <button class="btn-confirmar-numeros" onclick="confirmarSelecaoNumeros()">‚úÖ Confirmar Sele√ß√£o</button>
        </div>
    </div>

    <!-- Modal para mostrar contagem de n√∫meros de um jogo espec√≠fico -->
    <div id="modalContagemJogo">
        <div class="modal-contagem-content">
            <h3 id="tituloModalContagem">üéØ N√∫meros mais frequentes deste jogo</h3>
            <div id="gridContagemJogo" class="grid-contagem-jogo">
                <!-- Ser√° preenchido via JavaScript -->
            </div>
            <button class="btn-fechar-modal" onclick="fecharModalContagemJogo()">Fechar</button>
        </div>
    </div>

    <!-- Container principal com duas colunas -->
    <div class="main-container">
        <!-- Coluna esquerda - Scanner de Alta Performance -->
        <div class="left-column">
            <div class="scanner-container">
                <div class="scanner-header">
                    <h2>LotoF√°cil: Scanner de Alta Performance</h2>
                </div>
        
                <div class="como-funciona" style="margin-bottom: 20px; border: 1px solid #e2e8f0; border-radius: 10px; overflow: hidden;">
                    <button class="como-funciona-btn" onclick="toggleExplica√ß√£oScanner()" style="width: 100%; background: #f8fafc; border: none; padding: 12px; text-align: left; cursor: pointer; font-weight: bold; color: #9b2a92; display: flex; justify-content: space-between; align-items: center; transition: 0.3s;">
                        üí° Entenda como o Scanner funciona <span id="setaComoScanner">‚ñº</span>
                    </button>
                    <div id="explica√ß√£oContentScanner" style="padding: 0; max-height: 0; overflow: hidden; transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1); background: white; color: #4a5568;">
                        <div style="padding: 20px; max-height: 400px; overflow-y: auto;">
                            <h3 style="color: #9b2a92; margin-top: 0; margin-bottom: 15px; border-bottom: 2px solid #f0f0f0; padding-bottom: 8px;">üìà Como o Scanner de Alta Performance Funciona</h3>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #7b1fa2; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                    <span style="background: #9b2a92; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">1</span>
                                    Amostragem Inteligente de Concursos
                                </h4>
                                <p style="margin: 0 0 10px 32px; line-height: 1.6;">
                                    O sistema analisa <strong>concursos hist√≥ricos</strong> para identificar padr√µes. Quanto maior o intervalo selecionado, mais dados s√£o processados.
                                </p>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #1976d2; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                    <span style="background: #2196f3; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">2</span>
                                    Processamento de Tentativas
                                </h4>
                                <p style="margin: 0 0 10px 32px; line-height: 1.6;">
                                    Cada <strong>tentativa</strong> representa um jogo gerado aleatoriamente e testado contra todos os concursos selecionados.
                                </p>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: #388e3c; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                                    <span style="background: #4caf50; color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">3</span>
                                    Configura√ß√£o Flex√≠vel de Busca
                                </h4>
                                <p style="margin: 0 0 10px 32px; line-height: 1.6;">
                                    Agora voc√™ pode escolher <strong>quantos concursos</strong> deseja analisar e <strong>a partir de qual concurso</strong> iniciar a contagem regressiva. O sistema buscar√° jogos que tenham o n√∫mero escolhido de vit√≥rias totais (üèÜ Total) nesse intervalo personalizado.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- NOVOS CAMPOS DE CONFIGURA√á√ÉO DA BUSCA -->
                <div class="busca-config">
                    <div class="campo-duplo">
                        <div class="campo">
                            <label for="quantidadeConcursos">üìä Quantidade de concursos</label>
                            <input type="number" id="quantidadeConcursos" placeholder="Ex: 40" value="40" min="1" max="500">
                        </div>
                        <div class="campo">
                            <label for="concursoReferencia">üéØ Concurso de refer√™ncia</label>
                            <input type="number" id="concursoReferencia" placeholder="Ex: 3000" min="1">
                        </div>
                    </div>
                    <small style="opacity: 0.8; display: block; text-align: center;">O sistema analisar√° os √∫ltimos X concursos a partir do concurso informado</small>
                </div>
                
                <!-- Seletor de Crit√©rio -->
                <div class="criterio-selector">
                    <label for="criterioBusca">üéØ Crit√©rio de busca:</label>
                    <select id="criterioBusca">
                        <option value="7">7 ou mais vit√≥rias</option>
                        <option value="8">8 ou mais vit√≥rias</option>
                        <option value="9">9 ou mais vit√≥rias</option>
                        <option value="10">10 ou mais vit√≥rias</option>
                        <option value="11" selected>11 ou mais vit√≥rias</option>
                    </select>
                </div>

                <div class="painel-financeiro" style="background: #1a202c; color: white; border-radius: 10px; padding: 15px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                    <div class="fin-box" style="display: flex; flex-direction: column; border-right: 1px solid #4a5568;">
                        <span class="fin-label" style="font-size: 10px; font-weight: bold; color: #a0aec0; text-transform: uppercase;">Total Gasto</span>
                        <span id="finInvestidoScanner" class="fin-val" style="font-size: 14px; font-weight: bold; margin-top: 5px;">R$ 0,00</span>
                    </div>
                    <div class="fin-box" style="display: flex; flex-direction: column; border-right: 1px solid #4a5568;">
                        <span class="fin-label" style="font-size: 10px; font-weight: bold; color: #a0aec0; text-transform: uppercase;">Retorno</span>
                        <span id="finGanhoScanner" class="fin-val" style="font-size: 14px; font-weight: bold; margin-top: 5px; color: #48bb78">R$ 0,00</span>
                    </div>
                    <div class="fin-box" style="display: flex; flex-direction: column;">
                        <span class="fin-label" style="font-size: 10px; font-weight: bold; color: #a0aec0; text-transform: uppercase;">Balan√ßo</span>
                        <span id="finResultadoScanner" class="fin-val" style="font-size: 14px; font-weight: bold; margin-top: 5px;">R$ 0,00</span>
                    </div>
                </div>

                <div class="dashboard-cobertura" style="background: #fff; border: 1px solid #ddd; padding: 12px; border-radius: 10px; margin-bottom: 20px;">
                    <div class="stats-grid" style="display: grid; grid-template-columns: 1fr 1fr; text-align: center; font-size: 12px; font-weight: bold; color: #4a5568; gap: 10px;">
                        <div style="background: #f7fafc; padding: 8px; border-radius: 6px;">Cobertos: <span id="valCobertosScanner" style="color: #9b2a92;">0</span></div>
                        <div style="background: #f7fafc; padding: 8px; border-radius: 6px;">N√£o premiados: <span id="valLacunasScanner" style="color: #e74c3c;">0</span></div>
                    </div>
                    <div class="progress-container" style="background: #edf2f7; border-radius: 20px; height: 10px; margin: 12px 0; overflow: hidden; border: 1px solid #e2e8f0;">
                        <div id="progressoBarraScanner" class="progress-bar" style="background: linear-gradient(90deg, #9b2a92, #209869); height: 100%; width: 0%; transition: 0.8s;"></div>
                    </div>
                    <center>
                        <small id="pctTextoSanner" style="color: #718096; font-weight: bold; font-size: 12px;">Cobertura: 0%</small>
                    </center>
                </div>

                <div class="config-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;">
                    <div class="campo" style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; font-weight: bold; color: #555;">Concurso Inicial:</label>
                        <input type="number" id="concFocoScanner" placeholder="Ex: 3100" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;" onfocus="this.style.borderColor='#9b2a92'">
                        <label>
                            <span id="infoUltimoConcursoScanner" style="font-size: 10px; color: #209869; margin-bottom: 2px; display: block; line-height: 1.3;">Carregando √∫ltimo concurso...</span>
                        </label>
                    </div>
                    <div class="campo" style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; font-weight: bold; color: #555;">Concurso Final (opcional):</label>
                        <input type="number" id="concFinalScanner" placeholder="Deixe em branco" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;" onfocus="this.style.borderColor='#9b2a92'">
                    </div>
                    <div class="campo" style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; font-weight: bold; color: #555;">Qtd de Jogos:</label>
                        <input type="number" id="qtdJogosScanner" value="6" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;" onfocus="this.style.borderColor='#9b2a92'" oninput="document.getElementById('qtdLucroPuroScanner').max = this.value">
                    </div>
                    <div class="campo" style="display: flex; flex-direction: column; gap: 5px;">
                        <label style="font-size: 12px; font-weight: bold; color: #555;">Tentativas:</label>
                        <input type="number" id="limiteTentativasScanner" value="10000" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;" onfocus="this.style.borderColor='#9b2a92'">
                    </div>
                    <div class="campo" style="display: flex; flex-direction: column; gap: 5px; grid-column: span 2;">
                        <label style="font-size: 12px; font-weight: bold; color: #555;">Foco Lucro:</label>
                        <input type="number" id="qtdLucroPuroScanner" value="2" title="Jogos focados apenas no lucro" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; outline: none; transition: 0.3s; width: 100%; box-sizing: border-box;" onfocus="this.style.borderColor='#9b2a92'">
                    </div>
                </div>

                <div class="controles" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px;">
                    <button id="btnIniciarScanner" class="btn-start" onclick="iniciarScannerBusca()" style="padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 15px; background: #9b2a92; color: white; width: 100%;">üîç Iniciar Scanner</button>
                    <button id="btnPararScanner" class="btn-stop" onclick="pararScannerTudo()" style="padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 15px; background: #e74c3c; color: white; display: none; width: 100%;">üõë Parar</button>
                </div>

                <div id="statusRealScanner" style="background: #fffde7; border: 1px solid #fbc02d; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; text-align: center;">
                    <div id="statusMsgScanner" style="font-weight: bold; color: #555; margin-bottom: 5px; font-size: 13px;">Processando...</div>
                    <span id="contadorTentativasScanner" class="contador-live" style="font-family: monospace; font-size: 18px; color: #9b2a92; font-weight: bold;">0</span>
                </div>

                <div id="resultadoFinalScanner" class="lista-jogos" style="margin-top: 15px; width: 100%;"></div>
                
                <button class="btn-transferir" onclick="transferirJogosScanner(false)" style="background: linear-gradient(45deg, #209869, #1e824c); color: white; font-size: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; padding: 14px; transition: 0.3s; width: 100%; margin: 15px 0;">
                    üì§ Transferir Jogos para o Painel Principal
                </button>
        
                <div class="aviso-legal" style="margin-top: 15px; font-size: 11px; color: #777; text-align: center; line-height: 1.4; padding: 10px; border-top: 1px dashed #ccc;">            
                    ‚ö†Ô∏è <b>Aviso:</b> Este sistema √© uma ferramenta independente. Os jogos gerados <b>n√£o garantem ganhos reais</b>.
                </div>
            </div>
        </div>
        
        <!-- Coluna direita - C√≥digo Principal -->
        <div class="right-column">
            <div id="cont-lotofacil" class="container lf-theme">
                <h2>Lotof√°cil</h2>
                
                <!-- Status do Loop Autom√°tico -->
                <div id="loopStatus" class="loop-status">
                    <span id="loopStatusMessage">üîÑ Busca autom√°tica em andamento...</span><br>
                    <small>Jogos verificados: <span id="loopTentativas">0</span></small>
                </div>
                
                <div class="busca-concurso">
                    <button class="btn-nav" onclick="navegarConcurso('lotofacil', -1)">-</button>
                    <input type="number" id="numLF" placeholder="N¬∫">
                    <button class="btn-nav" onclick="navegarConcurso('lotofacil', 1)">+</button>
                    <button class="btn-busca" onclick="resetarEBuscar('lotofacil', document.getElementById('numLF').value)">Buscar</button>
                </div>
                <p id="infoLF" class="concurso-info">Carregando...</p>
                <div id="bolasLF" class="bolas-container"></div>
                <div id="resumoLF" class="resumo-geral">Aguardando...</div>
                
                <!-- Se√ß√£o de contagem de n√∫meros sorteados -->
                <div class="contagem-numeros-sorteados">
                    <h3>üìä N√∫meros mais sorteados nos concursos pesquisados</h3>
                    <div id="contagemSorteadosLF" class="grid-numeros-sorteados">
                        <!-- Ser√° preenchido via JavaScript -->
                    </div>
                </div>
                
                <div class="add-jogo-section">
                    <label><b>Cadastrar Jogo:</b></label>
                    <div style="display: flex; gap: 5px;">
                        <input type="text" id="inputLF" placeholder="Digite de 15 a 20 n√∫meros" style="flex: 1;">
                        <button onclick="abrirSelecionadorNumeros('lotofacil')" style="background: var(--cor-lotofacil); color: white; border: none; border-radius: 5px; width: 40px; cursor: pointer; font-weight: bold; font-size: 18px;">üéØ</button>
                    </div>
                    <button class="btn btn-add-lf" onclick="adicionarJogo('lotofacil')">Salvar Jogo na Lista</button>
                    <button class="btn btn-random" onclick="gerarSurpresinha('lotofacil')">üé≤ Gerar Surpresinha (15 n√∫meros)</button>
                </div>
                <div class="secao-memoria">
                    <button class="btn-guardar" onclick="prepararSalvamentoSlot('lotofacil')">üíæ Guardar Lista Atual em um Slot</button>
                    <div class="grid-memoria">
                        <button class="btn-memoria btn-memoria-lf-A" onclick="carregarSlot('lotofacil', 'A')">Jogo A</button>
                        <button class="btn-memoria btn-memoria-lf-B" onclick="carregarSlot('lotofacil', 'B')">Jogo B</button>
                        <button class="btn-memoria btn-memoria-lf-C" onclick="carregarSlot('lotofacil', 'C')">Jogo C</button>
                        <button class="btn-memoria btn-memoria-lf-D" onclick="carregarSlot('lotofacil', 'D')">Jogo D</button>
                        <button class="btn-memoria btn-memoria-lf-E" onclick="carregarSlot('lotofacil', 'E')">Jogo E</button>
                    </div>
                </div>
                <div id="listaLF"></div>
                <button class="btn btn-limpar" onclick="confirmarLimpar('lotofacil')">Apagar Tudo</button>
                <div class="painel-financeiro" id="finLF">
                    <div class="financeiro-item"><span>Total Gasto:</span> <span id="valInvestidoLF">R$ 0,00</span></div>
                    <div class="financeiro-item"><span>Total de Ganhos:</span> <span id="valGanhoLF">R$ 0,00</span></div>
                    <div class="financeiro-total" id="statusLF">Saldo: R$ 0,00</div>
                    <div class="percentual-status" id="percentualLF"></div>
                </div>
                <div id="contagemEspecialLF" class="contagem-especial">
                    <strong>üèÜ Pr√™mios de Elite Acumulados:</strong>
                    <div id="count14LF">14 Acertos: 0x</div>
                    <div id="count15LF">15 Acertos: 0x</div>
                </div>
                <div class="aviso-legal">
                    ‚ö†Ô∏è <b>Aviso:</b> Ferramenta independente. N√£o possui v√≠nculo com a Caixa Econ√¥mica Federal.<br>
                    <b>üîû APOSTAR √â PARA MAIORES DE 18 ANOS</b>
                </div>

                <div style="text-align: center; font-size: 12px; color: #666; padding: 0px 0;">
                    <div style="position: relative; display: inline-block;">
                        <span style="border-bottom: 1px dashed #999;">
                            üë®‚Äçüíª Desenvolvido por: AIRON GON√áALVES DE MOURA
                        </span><br>
                        <span style="font-size: 18px; cursor: pointer;" onclick="showTooltip()">üìß</span>  
                        <span style="cursor: pointer;" onclick="showTooltip()">Contato</span>
                        <span class="tooltip-box" id="meuBalao" style="font-size: 14px">aironagm@gmail.com</span> 
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o do Scanner -->
    <div id="modalScannerConfirm" class="modal-scanner-confirm" style="display: none;">
        <div class="modal-scanner-confirm-content" style="background: white; padding: 25px; border-radius: 12px; max-width: 400px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative;">
            <button id="btnScannerClose" onclick="fecharModalScannerConfirm()" style="position: absolute; top: 10px; right: 10px; background: transparent; border: none; font-size: 20px; cursor: pointer; color: #666; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">√ó</button>
            
            <div id="modalScannerMsg" style="font-weight: bold; color: #333; margin-bottom: 15px; padding-top: 10px;"></div>
            <div class="modal-scanner-buttons" style="display: flex; gap: 10px; margin-top: 20px; justify-content: center; flex-wrap: wrap;">
                <button id="btnScannerConfirm" class="btn-scanner-confirm" style="padding: 12px 20px; background: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; flex: 1; min-width: 140px;">Confirmar</button>
                <button id="btnScannerCancel" class="btn-scanner-cancel" style="padding: 12px 20px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; flex: 1; min-width: 140px;">Cancelar</button>
                <button id="btnScannerCloseModal" class="btn-scanner-close" style="padding: 10px 15px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px; width: 100%; margin-top: 5px;">‚úï Fechar (N√£o transferir)</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // C√ìDIGO PRINCIPAL - APENAS LOTOF√ÅCIL
        // =============================================

        // Detec√ß√£o de mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        // Vari√°veis de controle do loop autom√°tico
        let loopAtivo = false;
        let loopParams = null;
        let loopTentativasCount = 0;
        let loopMaxTentativas = 20;
        let criterioBusca = 11; // Valor padr√£o (11 vit√≥rias)
        
        // L√≥gica de bits
        function dezenasParaMask(dezenas) {
            let mask = 0n;
            dezenas.forEach(n => {
                mask |= (1n << BigInt(n));
            });
            return mask;
        }
        
        function conferirVeloz(maskJogo, maskSorteio) {
            let intersec = maskJogo & maskSorteio;
            let c = 0;
            while (intersec > 0n) {
                intersec &= (intersec - 1n);
                c++;
            }
            return c;
        }

        // L√≥gica de √°udio
        function tocarAlertaElite() {
            try {
                const context = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = context.createOscillator();
                const gainNode = context.createGain();
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(880, context.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1320, context.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.1, context.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
                oscillator.connect(gainNode);
                gainNode.connect(context.destination);
                oscillator.start();
                oscillator.stop(context.currentTime + 0.5);
            } catch (e) {}
        }

        let abortarConsultaMassa = false;

        function carregarJogos(tipo) {
            let storage = JSON.parse(localStorage.getItem('jogos_LF')) || [];
            return storage.map(j => {
                if (Array.isArray(j)) return { numeros: j, vitorias: 0, vitorias11: 0, vitorias12: 0, vitorias13: 0, vitorias14: 0, vitorias15: 0, ganhoAcumulado: 0, concursosVistos: [] };
                if (!j.vitorias) j.vitorias = 0;
                if (!j.vitorias11) j.vitorias11 = 0;
                if (!j.vitorias12) j.vitorias12 = 0;
                if (!j.vitorias13) j.vitorias13 = 0;
                if (!j.vitorias14) j.vitorias14 = 0;
                if (!j.vitorias15) j.vitorias15 = 0;
                if (!j.ganhoAcumulado) j.ganhoAcumulado = 0;
                if (!j.concursosVistos) j.concursosVistos = [];
                return j;
            });
        }

        let dados = {
            lotofacil: { 
                ganhadores: [], 
                meusJogos: carregarJogos('lotofacil'), 
                api: 'lotofacil', 
                min: 15, 
                max: 20, 
                max_bolas: 15, 
                range: 25, 
                custo: 3.50,
                concursoAtual: null
            }
        };

        let financeiroH = {
            lotofacil: { investido: 0, ganho: 0, concursos_vistos: [] }
        };

        let contagemElite = {
            lotofacil: { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] }
        };

        let contagemNumerosSorteados = {
            lotofacil: {}
        };

        // Vari√°veis para sele√ß√£o de n√∫meros
        let tipoLoteriaAtual = 'lotofacil';
        let numerosSelecionados = [];
        
        // =============================================
        // FUN√á√ïES DE SELE√á√ÉO DE N√öMEROS
        // =============================================
        function abrirSelecionadorNumeros(tipo) {
            tipoLoteriaAtual = tipo;
            numerosSelecionados = [];
            
            const modal = document.getElementById('modalNumeros');
            const grid = document.getElementById('numerosGrid');
            grid.innerHTML = '';
            
            const range = 25;
            
            for (let i = 1; i <= range; i++) {
                const btn = document.createElement('button');
                btn.className = 'numero-btn';
                btn.textContent = i.toString().padStart(2, '0');
                btn.dataset.numero = i;
                btn.onclick = () => toggleNumeroSelecionado(i);
                grid.appendChild(btn);
            }
            
            atualizarContadorSelecionados();
            modal.style.display = 'flex';
        }
        
        function toggleNumeroSelecionado(numero) {
            const index = numerosSelecionados.indexOf(numero);
            const maxNumeros = 20;
            
            if (index === -1) {
                if (numerosSelecionados.length >= maxNumeros) {
                    mostrarToastScanner(`M√°ximo de ${maxNumeros} n√∫meros permitidos`, 'alerta', 'center');
                    return;
                }
                numerosSelecionados.push(numero);
            } else {
                numerosSelecionados.splice(index, 1);
            }
            
            atualizarContadorSelecionados();
        }
        
        function atualizarContadorSelecionados() {
            const contador = document.getElementById('contadorSelecionados');
            const min = 15;
            const max = 20;
            
            contador.textContent = `Selecionados: ${numerosSelecionados.length}/${max} (M√≠nimo: ${min})`;
            
            document.querySelectorAll('.numero-btn').forEach(btn => {
                const num = parseInt(btn.dataset.numero);
                if (numerosSelecionados.includes(num)) {
                    btn.classList.add('selecionado');
                    btn.style.backgroundColor = 'var(--cor-lotofacil)';
                    btn.style.borderColor = 'var(--cor-lotofacil)';
                } else {
                    btn.classList.remove('selecionado');
                    btn.style.backgroundColor = 'white';
                    btn.style.borderColor = '#ddd';
                }
            });
        }
        
        function limparSelecaoNumeros() {
            numerosSelecionados = [];
            atualizarContadorSelecionados();
        }
        
        function fecharModalNumeros() {
            document.getElementById('modalNumeros').style.display = 'none';
        }
        
        function confirmarSelecaoNumeros() {
            const min = 15;
            
            if (numerosSelecionados.length < min) {
                mostrarToastScanner(`Selecione pelo menos ${min} n√∫meros`, 'alerta', 'center');
                return;
            }
            
            const numerosOrdenados = [...numerosSelecionados].sort((a, b) => a - b);
            document.getElementById('inputLF').value = numerosOrdenados.join(' ');
            
            fecharModalNumeros();
            mostrarToastScanner(`${numerosSelecionados.length} n√∫meros selecionados!`, 'sucesso', 'center');
        }

        // =============================================
        // FUN√á√ïES DE SLOT
        // =============================================
        function prepararSalvamentoSlot(tipo) {
            const temJogos = dados[tipo].meusJogos.length > 0;
            const modal = document.getElementById('modalCustom');
            const msgEl = document.getElementById('modalMsg');
            const containerBotoes = document.getElementById('modalContainerBotoes');
            
            if (!temJogos) {
                msgEl.innerText = "N√£o h√° jogos na tela para salvar. Deseja salvar um slot vazio?";
                containerBotoes.innerHTML = '';
                
                const btnSimVazio = document.createElement('button');
                btnSimVazio.className = 'btn-modal btn-sim';
                btnSimVazio.innerText = 'Salvar Slot Vazio';
                btnSimVazio.onclick = () => {
                    modal.style.display = 'none';
                    exibirSelecaoSlotVazio(tipo);
                };
                containerBotoes.appendChild(btnSimVazio);
                
                const btnNao = document.createElement('button');
                btnNao.className = 'btn-modal btn-nao';
                btnNao.innerText = 'Cancelar';
                btnNao.onclick = () => {
                    modal.style.display = 'none';
                    restaurarBotoesModal();
                };
                containerBotoes.appendChild(btnNao);
                
                modal.style.display = 'flex';
                return;
            }

            msgEl.innerText = "Em qual Slot deseja guardar?";
            containerBotoes.innerHTML = '';
            ['A', 'B', 'C', 'D', 'E'].forEach(slot => {
                const btn = document.createElement('button');
                const existeSalvo = localStorage.getItem(`slot_${tipo}_${slot}`);
                btn.className = 'btn-modal btn-sim';
                if (existeSalvo) {
                    try {
                        const dadosSlot = JSON.parse(existeSalvo);
                        if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                            btn.innerText = `Jogo ${slot} (Vazio)`;
                            btn.style.backgroundColor = '#999';
                        } else {
                            btn.style.opacity = "0.6";
                            btn.innerText = `Jogo ${slot} (Ocupado)`;
                        }
                    } catch {
                        btn.style.opacity = "0.6";
                        btn.innerText = `Jogo ${slot} (Ocupado)`;
                    }
                } else {
                    btn.innerText = `Jogo ${slot} (Vazio)`;
                }
                btn.onclick = () => {
                    const dadosAtuais = localStorage.getItem(`slot_${tipo}_${slot}`);
                    
                    if (!dadosAtuais) {
                        executarSalvarSlot(tipo, slot);
                        modal.style.display = 'none';
                    } else {
                        try {
                            const dadosSlot = JSON.parse(dadosAtuais);
                            if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                                executarSalvarSlot(tipo, slot);
                                modal.style.display = 'none';
                            } else {
                                modal.style.display = 'none';
                                exibirModal(`O Slot ${slot} j√° tem jogos salvos. Deseja APAGAR os antigos e salvar a lista atual?`, () => {
                                    executarSalvarSlot(tipo, slot);
                                }, false);
                            }
                        } catch {
                            modal.style.display = 'none';
                            exibirModal(`O Slot ${slot} j√° tem jogos salvos. Deseja APAGAR os antigos e salvar a lista atual?`, () => {
                                executarSalvarSlot(tipo, slot);
                            }, false);
                        }
                    }
                };
                containerBotoes.appendChild(btn);
            });
            const btnCanc = document.createElement('button');
            btnCanc.className = 'btn-modal btn-nao';
            btnCanc.innerText = 'Cancelar';
            btnCanc.onclick = () => {
                restaurarBotoesModal();
                modal.style.display = 'none';
            };
            containerBotoes.appendChild(btnCanc);
            modal.style.display = 'flex';
        }

        function exibirSelecaoSlotVazio(tipo) {
            const modal = document.getElementById('modalCustom');
            const msgEl = document.getElementById('modalMsg');
            const containerBotoes = document.getElementById('modalContainerBotoes');
            
            msgEl.innerText = "Selecione um slot para salvar como vazio:";
            containerBotoes.innerHTML = '';
            
            ['A', 'B', 'C', 'D', 'E'].forEach(slot => {
                const btn = document.createElement('button');
                const existeSalvo = localStorage.getItem(`slot_${tipo}_${slot}`);
                btn.className = 'btn-modal btn-sim';
                if (existeSalvo) {
                    try {
                        const dadosSlot = JSON.parse(existeSalvo);
                        if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                            btn.innerText = `Jogo ${slot} (Vazio)`;
                            btn.style.backgroundColor = '#999';
                        } else {
                            btn.style.opacity = "0.6";
                            btn.innerText = `Jogo ${slot} (Ocupado)`;
                        }
                    } catch {
                        btn.style.opacity = "0.6";
                        btn.innerText = `Jogo ${slot} (Ocupado)`;
                    }
                } else {
                    btn.innerText = `Jogo ${slot} (Vazio)`;
                }
                btn.onclick = () => {
                    const dadosAtuais = localStorage.getItem(`slot_${tipo}_${slot}`);
                    
                    if (!dadosAtuais) {
                        salvarSlotVazio(tipo, slot);
                        modal.style.display = 'none';
                    } else {
                        try {
                            const dadosSlot = JSON.parse(dadosAtuais);
                            if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                                salvarSlotVazio(tipo, slot);
                                modal.style.display = 'none';
                            } else {
                                modal.style.display = 'none';
                                exibirModal(`O Slot ${slot} j√° tem jogos salvos. Deseja APAGAR os antigos e salvar como vazio?`, () => {
                                    salvarSlotVazio(tipo, slot);
                                }, false);
                            }
                        } catch {
                            modal.style.display = 'none';
                            exibirModal(`O Slot ${slot} j√° tem jogos salvos. Deseja APAGAR os antigos e salvar como vazio?`, () => {
                                salvarSlotVazio(tipo, slot);
                            }, false);
                        }
                    }
                };
                containerBotoes.appendChild(btn);
            });
            
            const btnCanc = document.createElement('button');
            btnCanc.className = 'btn-modal btn-nao';
            btnCanc.innerText = 'Cancelar';
            btnCanc.onclick = () => {
                restaurarBotoesModal();
                modal.style.display = 'none';
            };
            containerBotoes.appendChild(btnCanc);
            
            modal.style.display = 'flex';
        }

        function salvarSlotVazio(tipo, slot) {
            localStorage.setItem(`slot_${tipo}_${slot}`, JSON.stringify([]));
            exibirModal(`Slot ${slot} salvo como vazio!`, null, true);
            atualizarBotoesSlot(tipo);
        }

        function executarSalvarSlot(tipo, slot) {
            const jogosParaSalvar = dados[tipo].meusJogos.map(j => ({
                ...j,
                vitorias: 0,
                vitorias11: 0,
                vitorias12: 0,
                vitorias13: 0,
                vitorias14: 0,
                vitorias15: 0,
                ganhoAcumulado: 0,
                concursosVistos: []
            }));
            localStorage.setItem(`slot_${tipo}_${slot}`, JSON.stringify(jogosParaSalvar));
            exibirModal(`Jogos guardados com sucesso no Slot ${slot}!`, null, true);
            atualizarBotoesSlot(tipo);
        }

        function atualizarBotoesSlot(tipo) {
            const prefixo = 'lf';
            ['A', 'B', 'C', 'D', 'E'].forEach(slot => {
                const btn = document.querySelector(`.btn-memoria-${prefixo}-${slot}`);
                if (btn) {
                    const salvo = localStorage.getItem(`slot_${tipo}_${slot}`);
                    if (salvo) {
                        try {
                            const dadosSlot = JSON.parse(salvo);
                            if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                                btn.classList.add('slot-vazio');
                                btn.innerText = `Slot ${slot} (Vazio)`;
                            } else {
                                btn.classList.remove('slot-vazio');
                                btn.innerText = `Jogo ${slot}`;
                            }
                        } catch {
                            btn.classList.remove('slot-vazio');
                            btn.innerText = `Jogo ${slot}`;
                        }
                    } else {
                        btn.classList.remove('slot-vazio');
                        btn.innerText = `Jogo ${slot}`;
                    }
                }
            });
        }

        function restaurarBotoesModal() {
            document.getElementById('modalContainerBotoes').innerHTML = `
                <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
                <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
            `;
        }

        function carregarSlot(tipo, slot) {
            const salvo = localStorage.getItem(`slot_${tipo}_${slot}`);
            if (salvo) {
                try {
                    const dadosSlot = JSON.parse(salvo);
                    if (dadosSlot.length === 0 || (dadosSlot.length === 1 && dadosSlot[0].numeros && dadosSlot[0].numeros.length === 0)) {
                        exibirModal(`O Jogo ${slot} est√° vazio.`, null, true);
                        return;
                    }
                    
                    financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] };
                    contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
                    dados[tipo].meusJogos = dadosSlot;
                    
                    salvarNoLocalStorage(tipo);
                    renderizar(tipo);
                    
                    document.querySelectorAll(`.btn-memoria`).forEach(btn => {
                        if(btn.className.includes('btn-memoria-lf')) btn.classList.remove('slot-active');
                    });
                    const btnSel = document.querySelector(`.btn-memoria-lf-${slot}`);
                    if(btnSel) btnSel.classList.add('slot-active');
                    exibirModal(`Jogo ${slot} carregado para confer√™ncia!`, null, true);
                } catch (e) {
                    exibirModal(`Erro ao carregar o Jogo ${slot}.`, null, true);
                }
            } else {
                exibirModal(`O Jogo ${slot} est√° vazio.`, null, true);
            }
        }

        function exibirModal(msg, callback, apenasAviso = false) {
            restaurarBotoesModal();
            const modal = document.getElementById('modalCustom');
            const msgEl = document.getElementById('modalMsg');
            const btnSim = document.getElementById('btnSim');
            const btnNao = document.getElementById('btnNao');
            msgEl.innerText = msg;
            modal.style.display = 'flex';
            btnNao.style.display = apenasAviso ? 'none' : 'block';
            btnSim.innerText = apenasAviso ? 'OK' : 'Confirmar';
            btnSim.onclick = () => {
                modal.style.display = 'none';
                if (callback) callback();
            };
            btnNao.onclick = () => {
                modal.style.display = 'none';
            };
        }

        // =============================================
        // FUN√á√ïES DE BUSCA NA API
        // =============================================
        async function buscar(tipo, concurso = 'latest') {
            const idInfo = 'infoLF';
            const idInput = 'numLF';
            const idBolas = 'bolasLF';
            const bolasEl = document.getElementById(idBolas);
            
            const termo = (concurso === '' || concurso === null) ? 'latest' : concurso;
            
            const apis = [
                `https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/${termo}`,
                `https://api-loteria.vercel.app/api/${dados[tipo].api}/${termo}`,
                `https://www.lotodicas.com.br/api/${dados[tipo].api}/${termo}`
            ];
            
            let data = null;
            
            for (let apiUrl of apis) {
                try {
                    console.log(`Tentando API: ${apiUrl}`);
                    const response = await fetch(apiUrl, { timeout: 10000 });
                    if (!response.ok) throw new Error(`API ${apiUrl} falhou com status ${response.status}`);
                    data = await response.json();
                    console.log(`Sucesso com API: ${apiUrl}`);
                    break;
                } catch (error) {
                    console.warn(`Falha com API ${apiUrl}:`, error);
                    continue;
                }
            }
            
            if (data) {
                dados[tipo].concursoAtual = data.concurso || data.numero_concurso || data.numero;
                document.getElementById(idInput).value = dados[tipo].concursoAtual;
                
                let dezenas = [];
                if (data.dezenas) {
                    dezenas = data.dezenas.map(Number);
                } else if (data.numeros) {
                    dezenas = data.numeros.map(Number);
                } else if (data.numeros_sorteados) {
                    dezenas = data.numeros_sorteados.map(Number);
                }
                
                dados[tipo].ganhadores = dezenas;
                
                const dataFormatada = data.data ? data.data : (data.data_sorteio ? data.data_sorteio : 'Data n√£o dispon√≠vel');
                document.getElementById(idInfo).innerHTML = `Concurso ${dados[tipo].concursoAtual} - Data: ${dataFormatada}`;
                
                bolasEl.innerHTML = '';
                dezenas.forEach(num => {
                    bolasEl.innerHTML += `<div class="bola">${num}</div>`;
                });
                
                if (dados[tipo].ganhadores.length > 0) {
                    if (!contagemNumerosSorteados[tipo][dados[tipo].concursoAtual]) {
                        contagemNumerosSorteados[tipo][dados[tipo].concursoAtual] = {};
                    }
                    
                    dados[tipo].ganhadores.forEach(num => {
                        if (!contagemNumerosSorteados[tipo][dados[tipo].concursoAtual][num]) {
                            contagemNumerosSorteados[tipo][dados[tipo].concursoAtual][num] = 0;
                        }
                        contagemNumerosSorteados[tipo][dados[tipo].concursoAtual][num]++;
                    });
                }
                
                renderizar(tipo);
                return dados[tipo].concursoAtual;
            } else {
                document.getElementById(idInfo).innerHTML = `<span style="color:#d93025">‚ö†Ô∏è CONCURSO N√ÉO ENCONTRADO OU N√ÉO SORTEADO</span>`;
                bolasEl.innerHTML = '';
                for(let i=0; i < dados[tipo].max_bolas; i++) bolasEl.innerHTML += `<div class="bola" style="background:#ccc; color:#666">- -</div>`;
                dados[tipo].ganhadores = [];
                renderizar(tipo);
                return null;
            }
        }

        function limparEstatisticasJogos(tipo) {
            dados[tipo].meusJogos = dados[tipo].meusJogos.map(j => {
                return {
                    numeros: j.numeros,
                    vitorias: 0,
                    vitorias11: 0,
                    vitorias12: 0,
                    vitorias13: 0,
                    vitorias14: 0,
                    vitorias15: 0,
                    ganhoAcumulado: 0,
                    concursosVistos: []
                };
            });
            salvarNoLocalStorage(tipo);
        }

        // =============================================
        // CONFER√äNCIA EM MASSA
        // =============================================
        async function conferirMassa(tipo, inicio, fim, callback) {
            if (!inicio) {
                const inputMassaInicial = document.getElementById('massa_inicial_lotofacil');
                const inputMassaFinal = document.getElementById('massa_final_lotofacil');
                
                inicio = parseInt(inputMassaInicial.value);
                if (isNaN(inicio) || inicio <= 0) {
                    exibirModal("Digite um concurso inicial v√°lido.", null, true);
                    return false;
                }
                
                try {
                    const respLatest = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/latest`);
                    const dataLatest = await respLatest.json();
                    const ultimoConcurso = dataLatest.concurso;
                    
                    if (inputMassaFinal.value && inputMassaFinal.value.trim() !== '') {
                        fim = parseInt(inputMassaFinal.value);
                        if (isNaN(fim) || fim < inicio) {
                            exibirModal("Concurso final deve ser maior ou igual ao inicial.", null, true);
                            return false;
                        }
                        if (fim > ultimoConcurso) {
                            exibirModal(`Concurso final (${fim}) maior que o √∫ltimo dispon√≠vel (${ultimoConcurso}).`, null, true);
                            return false;
                        }
                    } else {
                        fim = ultimoConcurso;
                    }
                    
                    if (inicio > fim) {
                        exibirModal("Concurso inicial maior que o final.", null, true);
                        return false;
                    }
                } catch (err) {
                    exibirModal("Erro ao verificar √∫ltimo concurso.", null, true);
                    return false;
                }
            }
            
            abortarConsultaMassa = false;
            
            zerarFinanceiro(tipo);
            contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            contagemNumerosSorteados[tipo] = {};
            limparEstatisticasJogos(tipo);
            
            for (let c = inicio; c <= fim; c++) {
                if (abortarConsultaMassa) break;
                await buscar(tipo, c);
            }
            
            // Verificar se algum jogo tem o crit√©rio de vit√≥rias escolhido
            let encontrouCriterio = false;
            for (let jogo of dados[tipo].meusJogos) {
                if (jogo.vitorias >= criterioBusca) {
                    encontrouCriterio = true;
                    console.log(`Jogo com ${jogo.vitorias} vit√≥rias encontrado! (Crit√©rio: ${criterioBusca}+)`);
                    break;
                }
            }
            
            if (callback) callback(encontrouCriterio);
            return encontrouCriterio;
        }

        // =============================================
        // NOVA FUN√á√ÉO PARA CONFERIR CONCURSOS PERSONALIZADOS
        // =============================================
        async function conferirConcursosPersonalizados(tipo) {
            try {
                // Obter valores dos novos campos
                const quantidadeInput = document.getElementById('quantidadeConcursos');
                const referenciaInput = document.getElementById('concursoReferencia');
                
                const quantidade = parseInt(quantidadeInput.value);
                const referencia = parseInt(referenciaInput.value);
                
                // Valida√ß√µes
                if (isNaN(quantidade) || quantidade < 1) {
                    mostrarToastScanner("‚ö†Ô∏è Insira uma quantidade v√°lida de concursos", 'alerta', 'center');
                    return false;
                }
                
                if (isNaN(referencia) || referencia < 1) {
                    mostrarToastScanner("‚ö†Ô∏è Insira um concurso de refer√™ncia v√°lido", 'alerta', 'center');
                    return false;
                }
                
                // Calcular concurso inicial
                const concursoFinal = referencia;
                const concursoInicial = Math.max(1, concursoFinal - (quantidade - 1));
                
                console.log(`Conferindo ${quantidade} concursos: do ${concursoInicial} ao ${concursoFinal}`);
                
                // Zerar estat√≠sticas para esta confer√™ncia
                zerarFinanceiro(tipo);
                contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
                contagemNumerosSorteados[tipo] = {};
                limparEstatisticasJogos(tipo);
                
                // Conferir concurso por concurso
                for (let c = concursoInicial; c <= concursoFinal; c++) {
                    if (abortarConsultaMassa) break;
                    await buscar(tipo, c);
                }
                
                // Verificar se algum jogo tem o crit√©rio de vit√≥rias escolhido
                let encontrouCriterio = false;
                for (let jogo of dados[tipo].meusJogos) {
                    if (jogo.vitorias >= criterioBusca) {
                        encontrouCriterio = true;
                        console.log(`Jogo com ${jogo.vitorias} vit√≥rias encontrado nos ${quantidade} concursos! (Crit√©rio: ${criterioBusca}+)`);
                        break;
                    }
                }
                
                return encontrouCriterio;
                
            } catch (err) {
                console.error("Erro ao conferir concursos personalizados:", err);
                mostrarToastScanner("Erro ao conferir concursos.", 'erro', 'center');
                return false;
            }
        }

        function navegarConcurso(tipo, direcao) {
            const id = 'numLF';
            let val = parseInt(document.getElementById(id).value);
            if(!isNaN(val)) buscar(tipo, val + direcao);
        }

        function gerarSurpresinha(tipo) {
            let numeros = [];
            while(numeros.length < dados[tipo].min) {
                let n = Math.floor(Math.random() * dados[tipo].range) + 1;
                if(!numeros.includes(n)) numeros.push(n);
            }
            numeros.sort((a,b) => a - b);
            dados[tipo].meusJogos.push({
                numeros: numeros,
                vitorias: 0,
                vitorias11: 0,
                vitorias12: 0,
                vitorias13: 0,
                vitorias14: 0,
                vitorias15: 0,
                ganhoAcumulado: 0,
                concursosVistos: []
            });
            
            salvarNoLocalStorage(tipo);
            renderizar(tipo);
        }

        function adicionarJogo(tipo) {
            const input = document.getElementById('inputLF');
            let nums = input.value.split(/[\s,]+/).filter(n => n !== "").map(Number);
            const limiteMaximo = 25;
            if (nums.filter(n => n < 1 || n > limiteMaximo).length > 0) {
                exibirModal(`‚ö†Ô∏è N√∫meros fora do intervalo (01 a ${limiteMaximo})`, null, true);
                return;
            }
            let unicos = [...new Set(nums)];
            if (unicos.length !== nums.length) {
                exibirModal("‚ö†Ô∏è N√∫meros repetidos detectados!", null, true);
                return;
            }
            if (unicos.length < dados[tipo].min || unicos.length > dados[tipo].max) {
                exibirModal(`Digite entre ${dados[tipo].min} e ${dados[tipo].max} n√∫meros.`, null, true);
                return;
            }
            unicos.sort((a,b) => a-b);
            dados[tipo].meusJogos.push({
                numeros: unicos,
                vitorias: 0,
                vitorias11: 0,
                vitorias12: 0,
                vitorias13: 0,
                vitorias14: 0,
                vitorias15: 0,
                ganhoAcumulado: 0,
                concursosVistos: []
            });
            
            salvarNoLocalStorage(tipo);
            input.value = '';
            renderizar(tipo);
        }

        function salvarNoLocalStorage(tipo) {
            localStorage.setItem('jogos_LF', JSON.stringify(dados[tipo].meusJogos));
        }

        function confirmarRemover(tipo, index) {
            exibirModal("Deseja excluir este jogo?", () => {
                dados[tipo].meusJogos.splice(index, 1);
                salvarNoLocalStorage(tipo);
                renderizar(tipo);
            });
        }

        function confirmarLimpar(tipo) {
            exibirModal(`Deseja apagar todos os jogos?`, () => {
                dados[tipo].meusJogos = [];
                localStorage.removeItem('jogos_LF');
                financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] };
                contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
                contagemNumerosSorteados[tipo] = {};
                renderizar(tipo);
            });
        }

        function calcularPercentual(saldo, totalGasto) {
            if (totalGasto === 0) return 0;
            return (saldo / totalGasto) * 100;
        }

        function formatarPercentual(valor) {
            return Math.abs(valor).toFixed(2).replace('.', ',') + '%';
        }

        function atualizarPercentual(tipo) {
            const sufixo = 'LF';
            const valInvestidoElement = document.getElementById(`valInvestido${sufixo}`);
            const valGanhoElement = document.getElementById(`valGanho${sufixo}`);
            const percentualElement = document.getElementById(`percentual${sufixo}`);
            const saldoElement = document.getElementById(`status${sufixo}`);
            
            if (!percentualElement) return;
            
            const totalGasto = parseFloat(valInvestidoElement.innerText.replace('R$', '').replace(/\./g, '').replace(',', '.').trim());
            const totalGanho = parseFloat(valGanhoElement.innerText.replace('R$', '').replace(/\./g, '').replace(',', '.').trim());
            
            const saldo = totalGanho - totalGasto;
            
            const saldoTexto = saldo.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            
            const saldoNode = saldoElement.childNodes[0];
            if (saldoNode) {
                saldoNode.nodeValue = `Saldo: ${saldoTexto} `;
            }
            
            const percentual = calcularPercentual(saldo, totalGasto);
            
            percentualElement.className = 'percentual-status';
            
            if (percentual > 0) {
                percentualElement.classList.add('positivo');
                percentualElement.innerText = formatarPercentual(percentual);
            } else if (percentual < 0) {
                percentualElement.classList.add('negativo');
                percentualElement.innerText = formatarPercentual(percentual);
            } else {
                percentualElement.classList.add('zero');
                percentualElement.innerText = '0,00%';
            }
        }

        // =============================================
        // MODAL DE CONTAGEM POR JOGO
        // =============================================
        function abrirModalContagemJogo(tipo, indexJogo) {
            const modal = document.getElementById('modalContagemJogo');
            const grid = document.getElementById('gridContagemJogo');
            const titulo = document.getElementById('tituloModalContagem');
            
            const jogo = dados[tipo].meusJogos[indexJogo];
            
            titulo.innerHTML = `üéØ Frequ√™ncia dos n√∫meros - Jogo ${indexJogo + 1}`;
            grid.innerHTML = '';

            const contagemTotal = {};
            const range = 25;
            for (let i = 1; i <= range; i++) {
                contagemTotal[i] = 0;
            }

            Object.values(contagemNumerosSorteados[tipo] || {}).forEach(concurso => {
                Object.entries(concurso).forEach(([num, qtd]) => {
                    contagemTotal[num] += qtd;
                });
            });
            
            const numerosDoJogo = jogo.numeros.map(num => ({
                numero: num,
                contagem: contagemTotal[num] || 0
            }));
            
            numerosDoJogo.sort((a, b) => b.contagem - a.contagem);
            
            numerosDoJogo.forEach(item => {
                grid.innerHTML += `
                    <div class="numero-contagem-item">
                        <span class="numero">${item.numero.toString().padStart(2, '0')}</span>
                        <span class="contagem">${item.contagem}x</span>
                    </div>
                `;
            });
            
            modal.style.display = 'flex';
        }
        
        function fecharModalContagemJogo() {
            document.getElementById('modalContagemJogo').style.display = 'none';
        }

        // =============================================
        // RENDERIZAR CONTAGEM DE N√öMEROS SORTEADOS
        // =============================================
        function renderizarContagemNumerosSorteados(tipo) {
            const sufixo = 'LF';
            const containerSorteados = document.getElementById(`contagemSorteados${sufixo}`);
            
            if (!containerSorteados) return;
            
            const contagemTotalSorteados = {};
            const range = 25;
            
            for (let i = 1; i <= range; i++) {
                contagemTotalSorteados[i] = 0;
            }
            
            Object.values(contagemNumerosSorteados[tipo] || {}).forEach(concurso => {
                Object.entries(concurso).forEach(([num, qtd]) => {
                    contagemTotalSorteados[num] += qtd;
                });
            });
            
            const numerosOrdenados = [];
            for (let i = 1; i <= range; i++) {
                numerosOrdenados.push({
                    numero: i,
                    contagem: contagemTotalSorteados[i] || 0
                });
            }
            
            numerosOrdenados.sort((a, b) => b.contagem - a.contagem);
            
            containerSorteados.innerHTML = '';
            numerosOrdenados.forEach(item => {
                containerSorteados.innerHTML += `
                    <div class="numero-sorteado-item">
                        <span class="numero">${item.numero.toString().padStart(2, '0')}</span>
                        <span class="contagem ${item.contagem > 0 ? 'destaque' : ''}">${item.contagem}x</span>
                    </div>
                `;
            });
        }

        function renderizar(tipo) {
            const lista = document.getElementById('listaLF');
            const resumo = document.getElementById('resumoLF');
            const classeAcerto = 'num-acertado-lf';
            
            if (dados[tipo].meusJogos.length === 0) {
                lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>';
                resumo.innerHTML = "Nenhum jogo salvo.";
                atualizarPainelFinanceiro(tipo);
                atualizarPainelElite(tipo);
                atualizarPercentual(tipo);
                renderizarContagemNumerosSorteados(tipo);
                return;
            }
            
            const concursoAtual = dados[tipo].concursoAtual;
            const maskSorteio = dezenasParaMask(dados[tipo].ganhadores);
            let totalInvestidoConcurso = dados[tipo].meusJogos.length * dados[tipo].custo;
            let totalGanhoConcurso = 0;
            let totalPremiados = 0;
            let stats = {};
            let acertoElite14 = false;
            let acertoElite15 = false;
            
            dados[tipo].meusJogos.forEach((jogo, idx) => {
                const maskJogo = dezenasParaMask(jogo.numeros);
                const acertos = conferirVeloz(maskJogo, maskSorteio);
                const ganhou = acertos >= 11 && dados[tipo].ganhadores.length > 0;
                
                if (dados[tipo].ganhadores.length > 0) {
                    if (acertos === 14) acertoElite14 = true;
                    if (acertos === 15) acertoElite15 = true;
                }
                
                let valorGanhoNeste = 0;
                if(ganhou) {
                    if(acertos === 11) valorGanhoNeste = 7.00;
                    if(acertos === 12) valorGanhoNeste = 14.00;
                    if(acertos === 13) valorGanhoNeste = 35.00;
                    if(acertos === 14) valorGanhoNeste = 500.00;
                    if(acertos === 15) valorGanhoNeste = 1500000.00;
                }
                
                if (ganhou) {
                    if (concursoAtual && !jogo.concursosVistos.includes(concursoAtual)) {
                        jogo.vitorias = (jogo.vitorias || 0) + 1;
                        if(acertos === 11) jogo.vitorias11 = (jogo.vitorias11 || 0) + 1;
                        if(acertos === 12) jogo.vitorias12 = (jogo.vitorias12 || 0) + 1;
                        if(acertos === 13) jogo.vitorias13 = (jogo.vitorias13 || 0) + 1;
                        if(acertos === 14) jogo.vitorias14 = (jogo.vitorias14 || 0) + 1;
                        if(acertos === 15) jogo.vitorias15 = (jogo.vitorias15 || 0) + 1;
                        jogo.ganhoAcumulado = (jogo.ganhoAcumulado || 0) + valorGanhoNeste;
                        jogo.concursosVistos.push(concursoAtual);
                    }
                    totalPremiados++;
                    stats[acertos] = (stats[acertos] || 0) + 1;
                    totalGanhoConcurso += valorGanhoNeste;
                }
                jogo.ultimoAcertoTemp = acertos;
            });
            
            if (concursoAtual && !contagemElite[tipo].concursos_processados.includes(concursoAtual) && dados[tipo].ganhadores.length > 0) {
                if (acertoElite14) {
                    contagemElite[tipo].c14++;
                    contagemElite[tipo].lista14.push(concursoAtual);
                    tocarAlertaElite();
                }
                if (acertoElite15) {
                    contagemElite[tipo].c15++;
                    contagemElite[tipo].lista15.push(concursoAtual);
                    tocarAlertaElite();
                }
                contagemElite[tipo].concursos_processados.push(concursoAtual);
            }
            
            processarAcumulo(tipo, totalInvestidoConcurso, totalGanhoConcurso);
            salvarNoLocalStorage(tipo);
            dados[tipo].meusJogos.sort((a, b) => (b.ganhoAcumulado || 0) - (a.ganhoAcumulado || 0) || (b.vitorias || 0) - (a.vitorias || 0));
            
            lista.innerHTML = '<h3>Meus Jogos Salvos:</h3>';
            dados[tipo].meusJogos.forEach((jogo, idx) => {
                const acertos = jogo.ultimoAcertoTemp;
                const ganhou = acertos >= 11 && dados[tipo].ganhadores.length > 0;
                const htmlJogo = jogo.numeros.map(n => (dados[tipo].ganhadores.includes(n)) ? `<span class="${classeAcerto}">${n.toString().padStart(2, '0')}</span>` : n.toString().padStart(2, '0')).join(' ');
                
                let badgeCriterio = '';
                if (jogo.vitorias >= criterioBusca) {
                    badgeCriterio = `<span class="badge-onze-plus">üèÜ ${jogo.vitorias} PR√äMIOS! (Crit√©rio: ${criterioBusca}+)</span>`;
                }
                
                lista.innerHTML += `
                <div class="card-jogo ${ganhou ? 'premiado' : ''}">
                    <button class="remove-btn" onclick="confirmarRemover('${tipo}', ${idx})">X</button>
                    <div style="font-family: monospace; font-size: 1.1em; margin-bottom:5px;">${htmlJogo}</div>
                    <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 5px; margin-top: 5px;">
                        <small><b>${acertos} ACERTOS</b></small>
                        ${jogo.vitorias > 0 ? `<span class="badge-vitorias">üèÜ Total: ${jogo.vitorias}x</span>` : ''}
                        ${jogo.vitorias11 > 0 ? `<span class="badge-onze">üéØ 11 pts: ${jogo.vitorias11}x</span>` : ''}
                        ${jogo.vitorias12 > 0 ? `<span class="badge-doze">‚ú® 12 pts: ${jogo.vitorias12}x</span>` : ''}
                        ${jogo.vitorias13 > 0 ? `<span class="badge-treze">üî• 13 pts: ${jogo.vitorias13}x</span>` : ''}
                        ${jogo.vitorias14 > 0 ? `<span class="badge-treze">üíé 14 pts: ${jogo.vitorias14}x</span>` : ''}
                        ${jogo.vitorias15 > 0 ? `<span class="badge-dinheiro">üí∞ 15 pts: ${jogo.vitorias15}x</span>` : ''}
                        ${jogo.ganhoAcumulado > 0 ? `<span class="badge-dinheiro">üí∞ R$ ${jogo.ganhoAcumulado.toFixed(2)}</span>` : ''}
                        ${badgeCriterio}
                        <button class="btn-ver-contagem" onclick="abrirModalContagemJogo('${tipo}', ${idx})">üìä Ver contagem</button>
                    </div>
                </div>`;
            });
            
            if (dados[tipo].ganhadores.length > 0) {
                if (totalPremiados > 0) {
                    let resumoHtml = `<strong>üéâ PARAB√âNS! ${totalPremiados} jogo(s) premiado(s)!</strong><br>`;
                    [15,14,13,12,11].forEach(f => {
                        if (stats[f]) resumoHtml += `<div class="caixa-acerto">${stats[f]} jogo(s) de <b>${f} acertos</b></div><br>`;
                    });
                    resumo.innerHTML = resumoHtml;
                } else resumo.innerHTML = "Nenhum jogo premiado neste concurso.";
            } else resumo.innerHTML = "Aguardando resultado...";
            
            atualizarPainelFinanceiro(tipo);
            atualizarPainelElite(tipo);
            
            renderizarContagemNumerosSorteados(tipo);
        }

        function atualizarPainelElite(tipo) {
            const sufixo = 'LF';
            const l14 = contagemElite[tipo].lista14.length > 0 ? " - " + contagemElite[tipo].lista14.join(", ") : "";
            const l15 = contagemElite[tipo].lista15.length > 0 ? " - " + contagemElite[tipo].lista15.join(", ") : "";
            document.getElementById(`count14${sufixo}`).innerHTML = `14 Acertos: <b>${contagemElite[tipo].c14}x</b> <small style="color:#666">${l14}</small>`;
            document.getElementById(`count15${sufixo}`).innerHTML = `15 Acertos: <b>${contagemElite[tipo].c15}x</b> <small style="color:#666">${l15}</small>`;
        }

        function processarAcumulo(tipo, custo, premio) {
            const conc = dados[tipo].concursoAtual;
            if (conc && !financeiroH[tipo].concursos_vistos.includes(conc) && dados[tipo].ganhadores.length > 0) {
                financeiroH[tipo].investido += custo;
                financeiroH[tipo].ganho += premio;
                financeiroH[tipo].concursos_vistos.push(conc);
            }
        }

        function atualizarPainelFinanceiro(tipo) {
            const sufixo = 'LF';
            const saldo = financeiroH[tipo].ganho - financeiroH[tipo].investido;
            document.getElementById(`valInvestido${sufixo}`).innerText = `R$ ${financeiroH[tipo].investido.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            document.getElementById(`valGanho${sufixo}`).innerText = `R$ ${financeiroH[tipo].ganho.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            const el = document.getElementById(`status${sufixo}`);
            el.innerText = `Saldo: R$ ${saldo.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            el.className = 'financeiro-total ' + (saldo > 0 ? 'lucro' : (saldo < 0 ? 'prejuizo' : ''));
            atualizarPercentual(tipo);
        }

        function zerarFinanceiro(tipo) {
            financeiroH[tipo] = { investido: 0, ganho: 0, concursos_vistos: [] };
            atualizarPainelFinanceiro(tipo);
        }

        function resetarEBuscar(tipo, conc) {
            zerarFinanceiro(tipo);
            contagemElite[tipo] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            limparEstatisticasJogos(tipo);
            buscar(tipo, conc);
        }

        function unificarNovosBotoes() {
            const tipo = 'lotofacil';
            const container = document.querySelector(`#cont-${tipo} .add-jogo-section`);
            if (container) {
                const hr = document.createElement('hr');
                hr.style.margin = "10px 0";
                hr.style.opacity = "0.3";
                container.appendChild(hr);
                
                const divMassa = document.createElement('div');
                divMassa.innerHTML = `
                    <label style="font-size:12px"><b>Confer√™ncia em Massa:</b></label>
                    <div style="display:flex; gap:5px; margin-top:5px; flex-wrap:wrap;">
                        <input type="number" id="massa_inicial_${tipo}" placeholder="Conc. Inicial" style="flex:1; min-width:100px; padding:8px; font-size:12px">
                        <input type="number" id="massa_final_${tipo}" placeholder="Conc. Final (opc.)" style="flex:1; min-width:100px; padding:8px; font-size:12px">
                        <button id="btnMassa_${tipo}" class="btn" data-status="parado" style="flex:1; min-width:120px; background:#f39c12; color:white; font-size:12px" onclick="conferirMassa('${tipo}')">üîç Conferir</button>
                    </div>
                    <div id="progContainer_${tipo}" class="progress-container"><div id="progBar_${tipo}" class="progress-bar"></div></div>
                `;
                container.appendChild(divMassa);
                
                setTimeout(async () => {
                    try {
                        const resp = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${dados[tipo].api}/latest`);
                        const data = await resp.json();
                        if (data && data.concurso) {
                            const concursoInicial = Math.max(1, data.concurso - 40);
                            document.getElementById(`massa_inicial_${tipo}`).value = concursoInicial;
                        }
                    } catch (e) {
                        console.log("N√£o foi poss√≠vel obter o √∫ltimo concurso");
                    }
                }, 1000);
            }
        }

        // =====================================================================
        // SCANNER DE ALTA PERFORMANCE
        // =====================================================================
        
        let scannerJogosGerados = [];
        let scannerRodando = false;
        let scannerConcursosData = [];
        let scannerConcPremiadosGeral = new Set();
        let scannerJogosSelecionadosMasks = new Set();
        const PREMIOS_SCANNER = { 11: 7, 12: 14, 13: 35 };
        const CUSTO_JOGO_SCANNER = 3.50;
        
        function dezenasParaMaskScanner(dezenas) {
            let mask = 0;
            for (let n of dezenas) mask |= (1 << (n - 1));
            return mask;
        }
        
        function gerarDezenasScanner() {
            let n = new Set();
            while(n.size < 15) n.add(Math.floor(Math.random() * 25) + 1);
            let lista = [...n].sort((a,b) => a - b);
            return { lista: lista, mask: dezenasParaMaskScanner(lista) };
        }
        
        function conferirScanner(maskA, maskB) {
            let intersec = maskA & maskB;
            let acertos = 0;
            while (intersec) { intersec &= (intersec - 1); acertos++; }
            return acertos;
        }
        
        function atualizarDashboardScanner() {
            const totalConc = scannerConcursosData.length;
            const cobertos = scannerConcPremiadosGeral.size;
            const pct = totalConc > 0 ? (cobertos / totalConc) * 100 : 0;
            
            document.getElementById('valCobertosScanner').innerText = cobertos;
            document.getElementById('valLacunasScanner').innerText = totalConc - cobertos;
            document.getElementById('progressoBarraScanner').style.width = pct + "%";
            document.getElementById('pctTextoSanner').innerText = `Cobertura: ${pct.toFixed(1)}%`;

            const qtdJogosGerados = document.querySelectorAll('#resultadoFinalScanner .jogo-item').length;
            const investidoTotal = (CUSTO_JOGO_SCANNER * totalConc) * qtdJogosGerados;
            
            let ganhoTotal = 0;
            document.querySelectorAll('.retorno-valor-scanner').forEach(el => {
                ganhoTotal += parseFloat(el.getAttribute('data-valor'));
            });

            const liquido = ganhoTotal - investidoTotal;

            document.getElementById('finInvestidoScanner').innerText = `R$ ${investidoTotal.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            document.getElementById('finGanhoScanner').innerText = `R$ ${ganhoTotal.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            document.getElementById('finResultadoScanner').innerText = `R$ ${liquido.toLocaleString('pt-br', {minimumFractionDigits: 2})}`;
            document.getElementById('finResultadoScanner').style.color = liquido >= 0 ? '#209869' : '#e74c3c';
        }
        
        function pararScannerTudo() { 
            scannerRodando = false; 
            document.getElementById('btnPararScanner').style.display = 'none';
            document.getElementById('btnIniciarScanner').disabled = false;
        }
        
        function mostrarToastScanner(mensagem, tipo = 'info', posicao = 'top-right') {
            const toast = document.createElement('div');
            
            let corFundo, corBorda, icone;
            
            switch(tipo) {
                case 'sucesso':
                    corFundo = '#4CAF50';
                    corBorda = '#388E3C';
                    icone = '‚úÖ';
                    break;
                case 'erro':
                    corFundo = '#F44336';
                    corBorda = '#D32F2F';
                    icone = '‚ùå';
                    break;
                case 'alerta':
                    corFundo = '#FF9800';
                    corBorda = '#F57C00';
                    icone = '‚ö†Ô∏è';
                    break;
                case 'info':
                default:
                    corFundo = '#2196F3';
                    corBorda = '#1976D2';
                    icone = '‚ÑπÔ∏è';
            }
            
            let posicaoCSS;
            switch(posicao) {
                case 'center':
                    posicaoCSS = `
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                    `;
                    break;
                default:
                    posicaoCSS = `
                        top: 20px;
                        right: 20px;
                    `;
            }
            
            toast.style.cssText = `
                position: fixed;
                ${posicaoCSS}
                background: ${corFundo};
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                z-index: 10001;
                box-shadow: 0 8px 25px rgba(0,0,0,0.2);
                border-left: 6px solid ${corBorda};
                animation: slideInCenter 0.5s ease-out;
                font-weight: bold;
                opacity: 0.95;
                display: flex;
                align-items: center;
                gap: 10px;
                min-width: 300px;
                text-align: center;
                font-size: 14px;
                backdrop-filter: blur(5px);
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInCenter {
                    from {
                        opacity: 0;
                        transform: ${posicao === 'center' ? 'translate(-50%, -60%)' : 'translateX(20px)'};
                    }
                    to {
                        opacity: 0.95;
                        transform: ${posicao === 'center' ? 'translate(-50%, -50%)' : 'translateX(0)'};
                    }
                }
                
                @keyframes fadeOut {
                    from { opacity: 0.95; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            toast.innerHTML = `<div style="font-size: 18px;">${icone}</div><div>${mensagem}</div>`;
            document.body.appendChild(toast);
            
            setTimeout(() => { 
                toast.style.animation = 'fadeOut 0.5s ease-out forwards'; 
                setTimeout(() => toast.remove(), 500); 
            }, 3000);
        }

        // =============================================
        // FUN√á√ÉO PRINCIPAL DO SCANNER COM LOOP AUTOM√ÅTICO
        // =============================================
        async function iniciarScannerBusca() {
            const valConc = document.getElementById('concFocoScanner').value;
            const valFinal = document.getElementById('concFinalScanner').value;
            const valQtd = document.getElementById('qtdJogosScanner').value;
            const valTentativas = document.getElementById('limiteTentativasScanner').value;
            const valLucro = document.getElementById('qtdLucroPuroScanner').value;
            
            // Capturar o crit√©rio selecionado
            const criterioSelect = document.getElementById('criterioBusca');
            if (criterioSelect) {
                criterioBusca = parseInt(criterioSelect.value);
            }

            if (!valConc || parseInt(valConc) < 1) {
                mostrarToastScanner("‚ö†Ô∏è Insira um valor v√°lido para: Concurso Inicial", 'info', 'center');
                return;
            }
            if (!valQtd || parseInt(valQtd) < 1) {
                mostrarToastScanner("‚ö†Ô∏è Insira um valor v√°lido para: Qtd Total de Jogos", 'info', 'center');
                return;
            }
            if (!valTentativas || parseInt(valTentativas) < 1) {
                mostrarToastScanner("‚ö†Ô∏è Insira um valor v√°lido para: Tentativas Base", 'info', 'center');
                return;
            }
            if (!valLucro || parseInt(valLucro) < 1) {
                mostrarToastScanner("‚ö†Ô∏è Insira um valor v√°lido para: Jogos Foco Lucro Puro", 'info', 'center');
                return;
            }

            const inicioNum = parseInt(valConc);
            let fimNum = null;
            
            if (valFinal && valFinal.trim() !== '') {
                fimNum = parseInt(valFinal);
                if (isNaN(fimNum) || fimNum < 1) {
                    mostrarToastScanner("‚ö†Ô∏è Insira um valor v√°lido para: Concurso Final", 'info', 'center');
                    return;
                }
                if (fimNum < inicioNum) {
                    mostrarToastScanner("‚ö†Ô∏è Concurso final deve ser maior ou igual ao inicial", 'alerta', 'center');
                    return;
                }
            }
            
            // Salvar par√¢metros para o loop
            loopParams = {
                inicio: inicioNum,
                fim: fimNum,
                qtd: parseInt(valQtd),
                tentativas: parseInt(valTentativas),
                lucro: parseInt(valLucro)
            };
            
            loopTentativasCount = 0;
            
            // Iniciar o loop autom√°tico
            await executarLoopScanner();
        }
        
        async function executarLoopScanner() {
            if (!loopParams) return;
            
            loopAtivo = true;
            document.getElementById('loopStatus').style.display = 'block';
            document.getElementById('loopStatusMessage').innerHTML = `üîÑ Busca autom√°tica em andamento... (Crit√©rio: ${criterioBusca}+ vit√≥rias)`;
            
            while (loopAtivo && loopTentativasCount < loopMaxTentativas) {
                loopTentativasCount++;
                document.getElementById('loopTentativas').innerText = loopTentativasCount;
                
                // Executar o scanner
                const jogosGerados = await executarScannerBusca(
                    loopParams.inicio,
                    loopParams.fim,
                    loopParams.qtd,
                    loopParams.tentativas,
                    loopParams.lucro
                );
                
                if (jogosGerados && jogosGerados.length > 0) {
                    // Transferir automaticamente
                    await transferirJogosScanner(true); // true = modo silencioso (sem perguntar)
                    
                    // AGORA conferir usando os novos campos personalizados
                    const encontrou = await conferirConcursosPersonalizados('lotofacil');
                    
                    if (encontrou) {
                        document.getElementById('loopStatusMessage').innerHTML = `‚úÖ SUCESSO! Jogo com ${criterioBusca}+ vit√≥rias encontrado!`;
                        document.getElementById('loopStatusMessage').style.color = '#4caf50';
                        
                        loopAtivo = false;
                        
                        mostrarToastScanner(`üéâ JOGO COM ${criterioBusca} OU MAIS VIT√ìRIAS ENCONTRADO! Transferido automaticamente.`, 'sucesso', 'center');
                        
                        break;
                    } else {
                        document.getElementById('loopStatusMessage').innerHTML = `üîÑ Tentativa ${loopTentativasCount}: Nenhum jogo com ${criterioBusca}+ vit√≥rias. Reiniciando...`;
                        
                        // Pequena pausa entre as tentativas
                        await new Promise(r => setTimeout(r, 1000));
                    }
                } else {
                    document.getElementById('loopStatusMessage').innerHTML = `üîÑ Tentativa ${loopTentativasCount}: Falha ao gerar jogos. Reiniciando...`;
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
            
            if (loopTentativasCount >= loopMaxTentativas) {
                document.getElementById('loopStatusMessage').innerHTML = `‚ö†Ô∏è Limite de tentativas atingido. Nenhum jogo com ${criterioBusca}+ vit√≥rias encontrado.`;
                mostrarToastScanner('Limite de tentativas atingido. Tente com outros par√¢metros.', 'alerta', 'center');
            }
            
            document.getElementById('btnIniciarScanner').disabled = false;
            document.getElementById('btnPararScanner').style.display = 'none';
        }
        
        async function executarScannerBusca(inicioNum, fimNum, totalJogosDesejados, limiteBase, corteLucroPuro) {
            scannerRodando = true;
            scannerConcPremiadosGeral.clear();
            scannerJogosSelecionadosMasks.clear();
            scannerJogosGerados = [];
            
            document.getElementById('statusRealScanner').style.display = 'block';
            document.getElementById('resultadoFinalScanner').innerHTML = "";

            try {
                document.getElementById('statusMsgScanner').innerText = "Baixando resultados da API...";
                const resp = await fetch(`https://loteriascaixa-api.herokuapp.com/api/lotofacil/`);
                const dados = await resp.json();
                
                scannerConcursosData = dados.filter(c => c.concurso >= inicioNum && (fimNum ? c.concurso <= fimNum : true)).map(c => ({
                    id: c.concurso, 
                    mask: dezenasParaMaskScanner(c.dezenas.map(Number))
                }));
                
                if (scannerConcursosData.length === 0) {
                    mostrarToastScanner(`‚ö†Ô∏è Nenhum concurso encontrado de ${inicioNum} a ${fimNum || '√∫ltimo'}.`, 'erro');
                    document.getElementById('statusRealScanner').style.display = 'none';
                    return [];
                }

                for (let j = 1; j <= totalJogosDesejados; j++) {
                    if (!scannerRodando) break;

                    let melhorDoCiclo = { score: -1, jogo: [], mask: 0, s11:0, s12:0, s13:0, lucro: 0, ids: [], tentativasReais: 0 };
                    let modoHibrido = j > corteLucroPuro;
                    let limiteTentativasCiclo = modoHibrido ? (limiteBase * 2) : limiteBase;

                    for (let t = 1; t <= limiteTentativasCiclo; t++) {
                        if (!scannerRodando) break;

                        let candidato = gerarDezenasScanner();
                        if (scannerJogosSelecionadosMasks.has(candidato.mask)) continue;

                        let stats = { 11: 0, 12: 0, 13: 0, lucro: 0, ids: [] };

                        scannerConcursosData.forEach(conc => {
                            let pts = conferirScanner(candidato.mask, conc.mask);
                            if (pts >= 11 && pts <= 13) {
                                stats[pts]++;
                                stats.lucro += PREMIOS_SCANNER[pts];
                                stats.ids.push(conc.id);
                            }
                        });

                        let score = stats.lucro; 
                        let novosAtendidos = 0;

                        if (modoHibrido) {
                            novosAtendidos = stats.ids.filter(id => !scannerConcPremiadosGeral.has(id)).length;
                            score += (novosAtendidos * 85); 
                        }

                        if (score > melhorDoCiclo.score) {
                            melhorDoCiclo = {
                                score: score, 
                                jogo: candidato.lista, 
                                mask: candidato.mask, 
                                lucro: stats.lucro,
                                s11: stats[11], 
                                s12: stats[12], 
                                s13: stats[13],
                                novos: novosAtendidos, 
                                ids: stats.ids, 
                                tentativasReais: t, 
                                hibrido: modoHibrido
                            };
                        }

                        if (t % 500 === 0) {
                            document.getElementById('contadorTentativasScanner').innerText = `${t} / ${limiteTentativasCiclo}`;
                            document.getElementById('statusMsgScanner').innerText = `Escaneando Jogo ${j}...`;
                            await new Promise(r => setTimeout(r, 0));
                        }
                    }

                    if (melhorDoCiclo.score > -1) {
                        melhorDoCiclo.ids.forEach(id => scannerConcPremiadosGeral.add(id));
                        scannerJogosSelecionadosMasks.add(melhorDoCiclo.mask);
                        scannerJogosGerados.push(melhorDoCiclo.jogo);
                        exibirJogoScanner(j, melhorDoCiclo);
                        atualizarDashboardScanner();
                    }
                }
            } catch (e) {
                mostrarToastScanner("Erro ao carregar dados da API.", 'erro');
                console.error(e);
                return [];
            } finally {
                scannerRodando = false;
                document.getElementById('statusRealScanner').style.display = 'none';
            }
            
            return scannerJogosGerados;
        }
        
        function exibirJogoScanner(num, d) {
            const container = document.getElementById('resultadoFinalScanner');
            const item = document.createElement('div');
            item.className = 'jogo-item';
            item.style.cssText = `
                background: white;
                border: 1px solid #eee;
                border-radius: 12px;
                padding: 18px;
                margin-bottom: 15px;
                position: relative;
                border-left: 6px solid ${d.hibrido ? '#f39c12' : '#9b2a92'};
                box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            `;
            
            item.innerHTML = `
                <div style="position: absolute; top: -10px; left: 15px; background: ${d.hibrido ? '#f39c12' : '#9b2a92'}; color: white; padding: 3px 12px; border-radius: 20px; font-size: 10px; font-weight: bold;">
                    ${d.hibrido ? 'SCAN H√çBRIDO (LACUNA+LUCRO)' : 'BUSCA: FOCO LUCRO PURO'} - JOGO ${num}
                </div>
                <div class="dezenas" style="display: flex; flex-wrap: wrap; gap: 6px; margin: 12px 0;">
                    ${d.jogo.map(n => `
                        <div class="bola" style="width: 32px; height: 32px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; color: #9b2a92; border: 2px solid #9b2a92;">
                            ${n.toString().padStart(2, '0')}
                        </div>
                    `).join('')}
                </div>
                <div class="resumo-financeiro" style="background: #f0fff4; padding: 12px; border-radius: 8px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px; border: 1px solid #c6f6d5;">
                    <div class="lucro-destaque" style="grid-column: span 2; font-size: 15px; color: #209869; font-weight: bold; text-align: center; border-bottom: 1px solid #c6f6d5; padding-bottom: 5px; margin-bottom: 5px;">
                        RETORNO HIST√ìRICO: <span class="retorno-valor-scanner" data-valor="${d.lucro}">R$ ${d.lucro.toFixed(2)}</span>
                    </div>
                    <span>üéØ 13 Pontos: <b>${d.s13}x</b></span>
                    <span>ü•à 12 Pontos: <b>${d.s12}x</b></span>
                    <span>ü•â 11 Pontos: <b>${d.s11}x</b></span>
                    <span>‚ú® Novas Lacunas: <b>+${d.novos}</b></span>
                    <span style="grid-column: span 2; font-size: 9px; color: #999; text-align: center; margin-top: 5px;">Analisado em ${d.tentativasReais} tentativas</span>
                </div>
            `;
            container.appendChild(item);
        }
        
        function transferirJogosScanner(modoSilencioso = false) {
            if (scannerJogosGerados.length === 0) {
                if (!modoSilencioso) {
                    mostrarToastScanner("N√£o h√° jogos gerados para transferir.", 'erro', 'center');
                }
                return false;
            }
            
            const jogosExistentes = dados['lotofacil'].meusJogos.length;
            
            if (jogosExistentes > 0 && !modoSilencioso) {
                // Mostrar modal de confirma√ß√£o
                const modal = document.getElementById('modalScannerConfirm');
                const msgEl = document.getElementById('modalScannerMsg');
                const btnConfirm = document.getElementById('btnScannerConfirm');
                const btnCancel = document.getElementById('btnScannerCancel');
                const btnCloseModal = document.getElementById('btnScannerCloseModal');
                
                msgEl.innerHTML = `
                    <div style="text-align: left;">
                        <p style="color: #f39c12; font-size: 16px; margin-bottom: 10px;"><strong>‚ö†Ô∏è Aten√ß√£o!</strong></p>
                        <p>Voc√™ tem <strong style="color: #9b2a92;">${jogosExistentes} jogo(s)</strong> salvos no painel principal.</p>
                        <p>Deseja <strong style="color: #d93025;">APAGAR todos os jogos atuais</strong> e substituir pelos <strong style="color: #209869;">${scannerJogosGerados.length} jogo(s)</strong> gerados no scanner?</p>
                        <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; border-radius: 5px; margin-top: 15px; font-size: 12px;">
                            <strong>üìù Observa√ß√£o:</strong> Esta a√ß√£o n√£o pode ser desfeita.
                        </div>
                    </div>
                `;
                
                btnConfirm.innerText = 'üîÑ Substituir (Apagar tudo)';
                btnConfirm.style.background = '#d93025';
                
                btnCancel.innerText = '‚ûï Adicionar (Manter atual)';
                btnCancel.style.background = '#2196F3';
                
                btnCloseModal.innerText = '‚úï Fechar (N√£o transferir)';
                btnCloseModal.style.background = '#666';
                
                modal.style.display = 'flex';
                
                btnConfirm.onclick = function() {
                    modal.style.display = 'none';
                    executarTransferenciaScanner(true);
                };
                
                btnCancel.onclick = function() {
                    modal.style.display = 'none';
                    executarTransferenciaScanner(false);
                };
                
                btnCloseModal.onclick = function() {
                    modal.style.display = 'none';
                    if (!modoSilencioso) {
                        mostrarToastScanner("‚ùå Transfer√™ncia cancelada.", 'info', 'center');
                    }
                };
                
                return true;
            } else {
                // Sem jogos existentes ou modo silencioso: transferir diretamente
                if (modoSilencioso && jogosExistentes > 0) {
                    // No modo silencioso, sempre substituir para garantir que estamos testando apenas os novos jogos
                    dados['lotofacil'].meusJogos = [];
                }
                executarTransferenciaScanner(jogosExistentes > 0 && !modoSilencioso);
                return true;
            }
        }

        function fecharModalScannerConfirm() {
            const modal = document.getElementById('modalScannerConfirm');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function executarTransferenciaScanner(apagarExistentes) {
            if (apagarExistentes) {
                dados['lotofacil'].meusJogos = [];
                financeiroH['lotofacil'] = { investido: 0, ganho: 0, concursos_vistos: [] };
                contagemElite['lotofacil'] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            }
            
            scannerJogosGerados.forEach(jogo => {
                dados['lotofacil'].meusJogos.push({
                    numeros: jogo,
                    vitorias: 0,
                    vitorias11: 0,
                    vitorias12: 0,
                    vitorias13: 0,
                    vitorias14: 0,
                    vitorias15: 0,
                    ganhoAcumulado: 0,
                    concursosVistos: []
                });
            });
            
            salvarNoLocalStorage('lotofacil');
            renderizar('lotofacil');
            
            mostrarToastScanner(`‚úÖ ${scannerJogosGerados.length} jogos transferidos com sucesso!`, 'sucesso', 'center');
        }

        function toggleExplica√ß√£oScanner() {
            const content = document.getElementById('explica√ß√£oContentScanner');
            const seta = document.getElementById('setaComoScanner');
            if (content.style.maxHeight === "0px" || content.style.maxHeight === "") {
                content.style.maxHeight = "500px";
                seta.innerText = "‚ñ≤";
            } else {
                content.style.maxHeight = "0px";
                seta.innerText = "‚ñº";
            }
        }
     
        async function carregarUltimoConcursoScanner() {
            try {
                const resp = await fetch(`https://loteriascaixa-api.herokuapp.com/api/lotofacil/latest`);
                const dados = await resp.json();
                if (dados && dados.concurso) {
                    document.getElementById('infoUltimoConcursoScanner').innerText = `√öltimo concurso: ${dados.concurso} (${dados.data})`;
                    const concursoInicial = Math.max(1, dados.concurso - 10);
                    document.getElementById('concFocoScanner').value = concursoInicial;
                    
                    // Pr√©-preencher o campo de refer√™ncia com o √∫ltimo concurso
                    const refInput = document.getElementById('concursoReferencia');
                    if (refInput) {
                        refInput.value = dados.concurso;
                    }
                }
            } catch (e) {
                document.getElementById('infoUltimoConcursoScanner').innerText = "Erro ao carregar √∫ltimo";
            }
        }

        function fecharScanner() {
            document.getElementById('modalScanner').style.display = 'none';
            if (isMobile) {
                document.body.style.overflow = 'auto';
            }
            scannerJogosGerados = [];
            restaurarBotoesModal();
            
            // Parar o loop se estiver ativo
            loopAtivo = false;
            document.getElementById('loopStatus').style.display = 'none';
        }

        function restaurarBotoesModal() {
            const modal = document.getElementById('modalCustom');
            const container = document.getElementById('modalContainerBotoes');
            
            if (container) {
                container.innerHTML = `
                    <button id="btnSim" class="btn-modal btn-sim">Confirmar</button>
                    <button id="btnNao" class="btn-modal btn-nao">Cancelar</button>
                `;
                
                const btnSim = document.getElementById('btnSim');
                const btnNao = document.getElementById('btnNao');
                
                if (btnSim && btnNao) {
                    btnSim.onclick = function() {
                        modal.style.display = 'none';
                    };
                    btnNao.onclick = function() {
                        modal.style.display = 'none';
                    };
                }
            }
        }

        // Tooltip do contato
        let tooltipTimeout;

        function showTooltip() {
            const tooltip = document.getElementById('meuBalao');
            
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
            }
            
            tooltip.classList.add('show');
            
            tooltipTimeout = setTimeout(() => {
                tooltip.classList.remove('show');
            }, 3000);
           
            tooltip.onclick = function(e) {
                e.stopPropagation();
                copyToClipboard('aironagm@gmail.com');
                
                const originalText = tooltip.innerHTML;
                tooltip.innerHTML = '‚úÖ Email copiado!';
                tooltip.style.background = '#27ae60';
               
                setTimeout(() => {
                    tooltip.innerHTML = originalText;
                    tooltip.style.background = '#2c3e50';
                }, 1500);
            };
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                console.log('Email copiado: ' + text);
            }).catch(err => {
                console.error('Erro ao copiar: ', err);
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }

        document.addEventListener('click', function(event) {
            const tooltip = document.getElementById('meuBalao');
            if (!tooltip.contains(event.target) && 
                !event.target.matches('[onclick*="showTooltip"]')) {
                tooltip.classList.remove('show');
                if (tooltipTimeout) {
                    clearTimeout(tooltipTimeout);
                }
            }
        });

        // =============================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // =============================================

        window.onload = () => {
            zerarFinanceiro('lotofacil');
            contagemElite['lotofacil'] = { c14: 0, c15: 0, lista14: [], lista15: [], concursos_processados: [] };
            contagemNumerosSorteados['lotofacil'] = {};
            
            limparEstatisticasJogos('lotofacil');
            buscar('lotofacil', 'latest');
            unificarNovosBotoes();
            
            atualizarBotoesSlot('lotofacil');
            
            // Inicializar o container do scanner como vis√≠vel
            // (j√° est√° vis√≠vel, n√£o precisa de modal)
        };
    </script>
</body>
</html>
